<?php

namespace App\Http\Controllers;

use App\Models\crf;
use App\Models\Subcript;
use App\Models\Supplier;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Http;
use Illuminate\Support\Facades\Log;

class SubcriptController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index()
    {
        try{
            $subcripts = Subcript::all();
            return $this->sendResponse($subcripts, );
        }
        catch (\Exception $e){
            return $this->sendError($e->getMessage());
        }
    }

    /**
     * Show the form for creating a new resource.
     */
    public function create(Request $request)
    {
        try{
            $subcript = new Subcript();
           $subcript->supplier_code = $request->supplier_code;
           if($subcript->supplier_code) {
               $supplier = Supplier::where('supplier_code', $subcript->supplier_code)->first();
               if (!$supplier) {
                   return $this->sendError('Supplier not found');
               }
           }

            $subcript->name = $request->name;
            $subcript->duration = $request->duration;
            $subcript->price = $request->price;
            $subcript->description = $request->description;
            $subcript->status = $request->status;
            $subcript->supplier_code = $request->supplier_code;
            $subcript->uuid = rand(1000000000, 9999999999);
            $subcript->save();
            //random 10 digit uuid
            return $this->sendResponse($subcript, );
        }
        catch (\Exception $e) {
            return $this->sendError($e->getMessage());
        }
    }

    /**
     * Store a newly created resource in storage.
     */
    public function store(Request $request)
    {
        //
    }

    /**
     * Display the specified resource.
     */
    public function show(crf $crf)
    {
        //
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit(crf $crf)
    {
        //
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, crf $crf)
    {
        //
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy($id)
    {
        try{
            $subcript = Subcript::find($id);
            $subcript->delete();
            return $this->sendResponse($subcript);
        }
        catch (\Exception $e){
            return $this->sendError($e->getMessage());
        }
    }

    private $appleSandboxUrl = 'https://sandbox.itunes.apple.com/verifyReceipt';
    private $appleProductionUrl = 'https://buy.itunes.apple.com/verifyReceipt';

    public function verifySubscription(Request $request)
    {
        // Step 1: Validate the request
        $request->validate([
            'receipt' => 'required|string',
        ]);

        $receiptData = 'TUlJeGpRWUpLb1pJaHZjTkFRY0NvSUl4ZmpDQ01Yb0NBUUV4RHpBTkJnbGdoa2dCWlFNRUFnRUZBRENDSU1NR0NTcUdTSWIzRFFFSEFhQ0NJTFFFZ2lDd01ZSWdyREFLQWdFSUFnRUJCQUlXQURBS0FnRVVBZ0VCQkFJTUFEQUxBZ0VCQWdFQkJBTUNBUUF3Q3dJQkF3SUJBUVFEREFFeE1Bc0NBUXNDQVFFRUF3SUJBREFMQWdFUEFnRUJCQU1DQVFBd0N3SUJFQUlCQVFRREFnRUFNQXNDQVJrQ0FRRUVBd0lCQXpBTUFnRUtBZ0VCQkFRV0FqUXJNQXdDQVE0Q0FRRUVCQUlDQVJzd0RRSUJEUUlCQVFRRkFnTUN2eUF3RFFJQkV3SUJBUVFGREFNeExqQXdEZ0lCQ1FJQkFRUUdBZ1JRTXpBME1CZ0NBUVFDQVFJRUVHcEZ0c256QTYxVEhqQU4yZnRpY01zd0dnSUJBZ0lCQVFRU0RCQmphVzVsYldGbmFXTnJhQzV1Wlhkek1Cc0NBUUFDQVFFRUV3d1JVSEp2WkhWamRHbHZibE5oYm1SaWIzZ3dIQUlCQlFJQkFRUVU1M1dyZjMzTlJuK1pKMExSTytJOUs0YzR3a1F3SGdJQkRBSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZERXlPakUyT2pFMldqQWVBZ0VTQWdFQkJCWVdGREl3TVRNdE1EZ3RNREZVTURjNk1EQTZNREJhTURvQ0FRY0NBUUVFTW5INk5mMm42VHdBdXI2M0FUWUcwdmx6cTZPUzRLRW9HNXFuYVFaVGxaSW9jOEVPa1E1WmFUSUZ5UU5MeEFGWVkyNE9NRmtDQVFZQ0FRRUVVUTRhaHRjNkJNTVc5YXdwekF1Njl4ODU0bXBDSG44alVVRmRWOE11L0FjNkQxdjAxQUZFUGErZjVsMGY5Y0hCaTZ6emp2Y2l3cDVEcTlYd1FHcGJTSWExMUs1Q3BGeitHdnZMNWloRyttS2tqakNDQVlVQ0FSRUNBUUVFZ2dGN01ZSUJkekFMQWdJR3JRSUJBUVFDREFBd0N3SUNCckFDQVFFRUFoWUFNQXNDQWdheUFnRUJCQUlNQURBTEFnSUdzd0lCQVFRQ0RBQXdDd0lDQnJRQ0FRRUVBZ3dBTUFzQ0FnYTFBZ0VCQkFJTUFEQUxBZ0lHdGdJQkFRUUNEQUF3REFJQ0JxVUNBUUVFQXdJQkFUQU1BZ0lHcXdJQkFRUURBZ0VETUF3Q0FnYXVBZ0VCQkFNQ0FRQXdEQUlDQnJFQ0FRRUVBd0lCQURBTUFnSUd0d0lCQVFRREFnRUFNQXdDQWdhNkFnRUJCQU1DQVFBd0VnSUNCcThDQVFFRUNRSUhCeHI5VGVqcCtUQVZBZ0lHcGdJQkFRUU1EQW8xTmpjeE5UYzFPREEyTUJzQ0FnYW5BZ0VCQkJJTUVESXdNREF3TURBM01EVTFNVFF6TlRNd0d3SUNCcWtDQVFFRUVnd1FNakF3TURBd01EY3dOVFV4TkRNMU16QWZBZ0lHcUFJQkFRUVdGaFF5TURJMExUQTVMVEExVkRBMU9qTTRPalEyV2pBZkFnSUdxZ0lCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREExT2pNNE9qUTNXakFmQWdJR3JBSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZEQTFPalF4T2pRMldqQ0NBWVVDQVJFQ0FRRUVnZ0Y3TVlJQmR6QUxBZ0lHclFJQkFRUUNEQUF3Q3dJQ0JyQUNBUUVFQWhZQU1Bc0NBZ2F5QWdFQkJBSU1BREFMQWdJR3N3SUJBUVFDREFBd0N3SUNCclFDQVFFRUFnd0FNQXNDQWdhMUFnRUJCQUlNQURBTEFnSUd0Z0lCQVFRQ0RBQXdEQUlDQnFVQ0FRRUVBd0lCQVRBTUFnSUdxd0lCQVFRREFnRURNQXdDQWdhdUFnRUJCQU1DQVFBd0RBSUNCckVDQVFFRUF3SUJBREFNQWdJR3R3SUJBUVFEQWdFQU1Bd0NBZ2E2QWdFQkJBTUNBUUF3RWdJQ0JxOENBUUVFQ1FJSEJ4cjlUZWpwK2pBVkFnSUdwZ0lCQVFRTURBbzFOamN4TlRjMU9EQTJNQnNDQWdhbkFnRUJCQklNRURJd01EQXdNREEzTURVMU1qQXhPVGd3R3dJQ0Jxa0NBUUVFRWd3UU1qQXdNREF3TURjd05UVXhORE0xTXpBZkFnSUdxQUlCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREExT2pRME9qSTNXakFmQWdJR3FnSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZEQTFPak00T2pRM1dqQWZBZ0lHckFJQkFRUVdGaFF5TURJMExUQTVMVEExVkRBMU9qUTNPakkzV2pDQ0FZVUNBUkVDQVFFRWdnRjdNWUlCZHpBTEFnSUdyUUlCQVFRQ0RBQXdDd0lDQnJBQ0FRRUVBaFlBTUFzQ0FnYXlBZ0VCQkFJTUFEQUxBZ0lHc3dJQkFRUUNEQUF3Q3dJQ0JyUUNBUUVFQWd3QU1Bc0NBZ2ExQWdFQkJBSU1BREFMQWdJR3RnSUJBUVFDREFBd0RBSUNCcVVDQVFFRUF3SUJBVEFNQWdJR3F3SUJBUVFEQWdFRE1Bd0NBZ2F1QWdFQkJBTUNBUUF3REFJQ0JyRUNBUUVFQXdJQkFEQU1BZ0lHdHdJQkFRUURBZ0VBTUF3Q0FnYTZBZ0VCQkFNQ0FRQXdFZ0lDQnE4Q0FRRUVDUUlIQnhyOVRlanI1VEFWQWdJR3BnSUJBUVFNREFvMU5qY3hOVGMxT0RBMk1Cc0NBZ2FuQWdFQkJCSU1FREl3TURBd01EQTNNRFUxTWpFNE1EUXdHd0lDQnFrQ0FRRUVFZ3dRTWpBd01EQXdNRGN3TlRVeE5ETTFNekFmQWdJR3FBSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZEQTFPalEzT2pJM1dqQWZBZ0lHcWdJQkFRUVdGaFF5TURJMExUQTVMVEExVkRBMU9qTTRPalEzV2pBZkFnSUdyQUlCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREExT2pVd09qSTNXakNDQVlVQ0FSRUNBUUVFZ2dGN01ZSUJkekFMQWdJR3JRSUJBUVFDREFBd0N3SUNCckFDQVFFRUFoWUFNQXNDQWdheUFnRUJCQUlNQURBTEFnSUdzd0lCQVFRQ0RBQXdDd0lDQnJRQ0FRRUVBZ3dBTUFzQ0FnYTFBZ0VCQkFJTUFEQUxBZ0lHdGdJQkFRUUNEQUF3REFJQ0JxVUNBUUVFQXdJQkFUQU1BZ0lHcXdJQkFRUURBZ0VETUF3Q0FnYXVBZ0VCQkFNQ0FRQXdEQUlDQnJFQ0FRRUVBd0lCQURBTUFnSUd0d0lCQVFRREFnRUFNQXdDQWdhNkFnRUJCQU1DQVFBd0VnSUNCcThDQVFFRUNRSUhCeHI5VGVqc216QVZBZ0lHcGdJQkFRUU1EQW8xTmpjeE5UYzFPREEyTUJzQ0FnYW5BZ0VCQkJJTUVESXdNREF3TURBM01EVTFNalV3TmpFd0d3SUNCcWtDQVFFRUVnd1FNakF3TURBd01EY3dOVFV4TkRNMU16QWZBZ0lHcUFJQkFRUVdGaFF5TURJMExUQTVMVEExVkRBMU9qVXdPakkzV2pBZkFnSUdxZ0lCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREExT2pNNE9qUTNXakFmQWdJR3JBSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZEQTFPalV6T2pJM1dqQ0NBWVVDQVJFQ0FRRUVnZ0Y3TVlJQmR6QUxBZ0lHclFJQkFRUUNEQUF3Q3dJQ0JyQUNBUUVFQWhZQU1Bc0NBZ2F5QWdFQkJBSU1BREFMQWdJR3N3SUJBUVFDREFBd0N3SUNCclFDQVFFRUFnd0FNQXNDQWdhMUFnRUJCQUlNQURBTEFnSUd0Z0lCQVFRQ0RBQXdEQUlDQnFVQ0FRRUVBd0lCQVRBTUFnSUdxd0lCQVFRREFnRURNQXdDQWdhdUFnRUJCQU1DQVFBd0RBSUNCckVDQVFFRUF3SUJBREFNQWdJR3R3SUJBUVFEQWdFQU1Bd0NBZ2E2QWdFQkJBTUNBUUF3RWdJQ0JxOENBUUVFQ1FJSEJ4cjlUZWp0bWpBVkFnSUdwZ0lCQVFRTURBbzFOamN4TlRjMU9EQTJNQnNDQWdhbkFnRUJCQklNRURJd01EQXdNREEzTURVMU1qWTJOamN3R3dJQ0Jxa0NBUUVFRWd3UU1qQXdNREF3TURjd05UVXhORE0xTXpBZkFnSUdxQUlCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREExT2pVek9qSTNXakFmQWdJR3FnSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZEQTFPak00T2pRM1dqQWZBZ0lHckFJQkFRUVdGaFF5TURJMExUQTVMVEExVkRBMU9qVTJPakkzV2pDQ0FZVUNBUkVDQVFFRWdnRjdNWUlCZHpBTEFnSUdyUUlCQVFRQ0RBQXdDd0lDQnJBQ0FRRUVBaFlBTUFzQ0FnYXlBZ0VCQkFJTUFEQUxBZ0lHc3dJQkFRUUNEQUF3Q3dJQ0JyUUNBUUVFQWd3QU1Bc0NBZ2ExQWdFQkJBSU1BREFMQWdJR3RnSUJBUVFDREFBd0RBSUNCcVVDQVFFRUF3SUJBVEFNQWdJR3F3SUJBUVFEQWdFRE1Bd0NBZ2F1QWdFQkJBTUNBUUF3REFJQ0JyRUNBUUVFQXdJQkFEQU1BZ0lHdHdJQkFRUURBZ0VBTUF3Q0FnYTZBZ0VCQkFNQ0FRQXdFZ0lDQnE4Q0FRRUVDUUlIQnhyOVRlanVvVEFWQWdJR3BnSUJBUVFNREFvMU5qY3hOVGMxT0RBMk1Cc0NBZ2FuQWdFQkJCSU1FREl3TURBd01EQTNNRFUxTXpBeU5qa3dHd0lDQnFrQ0FRRUVFZ3dRTWpBd01EQXdNRGN3TlRVeE5ETTFNekFmQWdJR3FBSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZEQTFPalUyT2pJM1dqQWZBZ0lHcWdJQkFRUVdGaFF5TURJMExUQTVMVEExVkRBMU9qTTRPalEzV2pBZkFnSUdyQUlCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREExT2pVNU9qSTNXakNDQVlVQ0FSRUNBUUVFZ2dGN01ZSUJkekFMQWdJR3JRSUJBUVFDREFBd0N3SUNCckFDQVFFRUFoWUFNQXNDQWdheUFnRUJCQUlNQURBTEFnSUdzd0lCQVFRQ0RBQXdDd0lDQnJRQ0FRRUVBZ3dBTUFzQ0FnYTFBZ0VCQkFJTUFEQUxBZ0lHdGdJQkFRUUNEQUF3REFJQ0JxVUNBUUVFQXdJQkFUQU1BZ0lHcXdJQkFRUURBZ0VETUF3Q0FnYXVBZ0VCQkFNQ0FRQXdEQUlDQnJFQ0FRRUVBd0lCQURBTUFnSUd0d0lCQVFRREFnRUFNQXdDQWdhNkFnRUJCQU1DQVFBd0VnSUNCcThDQVFFRUNRSUhCeHI5VGVqdnBEQVZBZ0lHcGdJQkFRUU1EQW8xTmpjeE5UYzFPREEyTUJzQ0FnYW5BZ0VCQkJJTUVESXdNREF3TURBM01EVTFNelUyTXpnd0d3SUNCcWtDQVFFRUVnd1FNakF3TURBd01EY3dOVFV4TkRNMU16QWZBZ0lHcUFJQkFRUVdGaFF5TURJMExUQTVMVEExVkRBMU9qVTVPakkzV2pBZkFnSUdxZ0lCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREExT2pNNE9qUTNXakFmQWdJR3JBSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZEQTJPakF5T2pJM1dqQ0NBWVVDQVJFQ0FRRUVnZ0Y3TVlJQmR6QUxBZ0lHclFJQkFRUUNEQUF3Q3dJQ0JyQUNBUUVFQWhZQU1Bc0NBZ2F5QWdFQkJBSU1BREFMQWdJR3N3SUJBUVFDREFBd0N3SUNCclFDQVFFRUFnd0FNQXNDQWdhMUFnRUJCQUlNQURBTEFnSUd0Z0lCQVFRQ0RBQXdEQUlDQnFVQ0FRRUVBd0lCQVRBTUFnSUdxd0lCQVFRREFnRURNQXdDQWdhdUFnRUJCQU1DQVFBd0RBSUNCckVDQVFFRUF3SUJBREFNQWdJR3R3SUJBUVFEQWdFQU1Bd0NBZ2E2QWdFQkJBTUNBUUF3RWdJQ0JxOENBUUVFQ1FJSEJ4cjlUZWp3blRBVkFnSUdwZ0lCQVFRTURBbzFOamN4TlRjMU9EQTJNQnNDQWdhbkFnRUJCQklNRURJd01EQXdNREEzTURVMU16ZzROREF3R3dJQ0Jxa0NBUUVFRWd3UU1qQXdNREF3TURjd05UVXhORE0xTXpBZkFnSUdxQUlCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREEyT2pBeU9qSTNXakFmQWdJR3FnSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZEQTFPak00T2pRM1dqQWZBZ0lHckFJQkFRUVdGaFF5TURJMExUQTVMVEExVkRBMk9qQTFPakkzV2pDQ0FZVUNBUkVDQVFFRWdnRjdNWUlCZHpBTEFnSUdyUUlCQVFRQ0RBQXdDd0lDQnJBQ0FRRUVBaFlBTUFzQ0FnYXlBZ0VCQkFJTUFEQUxBZ0lHc3dJQkFRUUNEQUF3Q3dJQ0JyUUNBUUVFQWd3QU1Bc0NBZ2ExQWdFQkJBSU1BREFMQWdJR3RnSUJBUVFDREFBd0RBSUNCcVVDQVFFRUF3SUJBVEFNQWdJR3F3SUJBUVFEQWdFRE1Bd0NBZ2F1QWdFQkJBTUNBUUF3REFJQ0JyRUNBUUVFQXdJQkFEQU1BZ0lHdHdJQkFRUURBZ0VBTUF3Q0FnYTZBZ0VCQkFNQ0FRQXdFZ0lDQnE4Q0FRRUVDUUlIQnhyOVRlanh1akFWQWdJR3BnSUJBUVFNREFvMU5qY3hOVGMxT0RBMk1Cc0NBZ2FuQWdFQkJCSU1FREl3TURBd01EQTNNRFUxTkRJek9UQXdHd0lDQnFrQ0FRRUVFZ3dRTWpBd01EQXdNRGN3TlRVeE5ETTFNekFmQWdJR3FBSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZEQTJPakExT2pJM1dqQWZBZ0lHcWdJQkFRUVdGaFF5TURJMExUQTVMVEExVkRBMU9qTTRPalEzV2pBZkFnSUdyQUlCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREEyT2pBNE9qSTNXakNDQVlVQ0FSRUNBUUVFZ2dGN01ZSUJkekFMQWdJR3JRSUJBUVFDREFBd0N3SUNCckFDQVFFRUFoWUFNQXNDQWdheUFnRUJCQUlNQURBTEFnSUdzd0lCQVFRQ0RBQXdDd0lDQnJRQ0FRRUVBZ3dBTUFzQ0FnYTFBZ0VCQkFJTUFEQUxBZ0lHdGdJQkFRUUNEQUF3REFJQ0JxVUNBUUVFQXdJQkFUQU1BZ0lHcXdJQkFRUURBZ0VETUF3Q0FnYXVBZ0VCQkFNQ0FRQXdEQUlDQnJFQ0FRRUVBd0lCQURBTUFnSUd0d0lCQVFRREFnRUFNQXdDQWdhNkFnRUJCQU1DQVFBd0VnSUNCcThDQVFFRUNRSUhCeHI5VGVqeTdqQVZBZ0lHcGdJQkFRUU1EQW8xTmpjeE5UYzFPREEyTUJzQ0FnYW5BZ0VCQkJJTUVESXdNREF3TURBM01EVTFORGN5T0RRd0d3SUNCcWtDQVFFRUVnd1FNakF3TURBd01EY3dOVFV4TkRNMU16QWZBZ0lHcUFJQkFRUVdGaFF5TURJMExUQTVMVEExVkRBMk9qQTRPakkzV2pBZkFnSUdxZ0lCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREExT2pNNE9qUTNXakFmQWdJR3JBSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZEQTJPakV4T2pJM1dqQ0NBWVVDQVJFQ0FRRUVnZ0Y3TVlJQmR6QUxBZ0lHclFJQkFRUUNEQUF3Q3dJQ0JyQUNBUUVFQWhZQU1Bc0NBZ2F5QWdFQkJBSU1BREFMQWdJR3N3SUJBUVFDREFBd0N3SUNCclFDQVFFRUFnd0FNQXNDQWdhMUFnRUJCQUlNQURBTEFnSUd0Z0lCQVFRQ0RBQXdEQUlDQnFVQ0FRRUVBd0lCQVRBTUFnSUdxd0lCQVFRREFnRURNQXdDQWdhdUFnRUJCQU1DQVFBd0RBSUNCckVDQVFFRUF3SUJBREFNQWdJR3R3SUJBUVFEQWdFQU1Bd0NBZ2E2QWdFQkJBTUNBUUF3RWdJQ0JxOENBUUVFQ1FJSEJ4cjlUZWowSHpBVkFnSUdwZ0lCQVFRTURBbzFOamN4TlRjMU9EQTJNQnNDQWdhbkFnRUJCQklNRURJd01EQXdNREEzTURVMU5UQTRNVE13R3dJQ0Jxa0NBUUVFRWd3UU1qQXdNREF3TURjd05UVXhORE0xTXpBZkFnSUdxQUlCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREEyT2pFeE9qSTNXakFmQWdJR3FnSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZEQTFPak00T2pRM1dqQWZBZ0lHckFJQkFRUVdGaFF5TURJMExUQTVMVEExVkRBMk9qRTBPakkzV2pDQ0FZVUNBUkVDQVFFRWdnRjdNWUlCZHpBTEFnSUdyUUlCQVFRQ0RBQXdDd0lDQnJBQ0FRRUVBaFlBTUFzQ0FnYXlBZ0VCQkFJTUFEQUxBZ0lHc3dJQkFRUUNEQUF3Q3dJQ0JyUUNBUUVFQWd3QU1Bc0NBZ2ExQWdFQkJBSU1BREFMQWdJR3RnSUJBUVFDREFBd0RBSUNCcVVDQVFFRUF3SUJBVEFNQWdJR3F3SUJBUVFEQWdFRE1Bd0NBZ2F1QWdFQkJBTUNBUUF3REFJQ0JyRUNBUUVFQXdJQkFEQU1BZ0lHdHdJQkFRUURBZ0VBTUF3Q0FnYTZBZ0VCQkFNQ0FRQXdFZ0lDQnE4Q0FRRUVDUUlIQnhyOVRlajFZREFWQWdJR3BnSUJBUVFNREFvMU5qY3hOVGMxT0RBMk1Cc0NBZ2FuQWdFQkJCSU1FREl3TURBd01EQTNNRFUxTlRNME1qZ3dHd0lDQnFrQ0FRRUVFZ3dRTWpBd01EQXdNRGN3TlRVeE5ETTFNekFmQWdJR3FBSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZEQTJPakUwT2pJM1dqQWZBZ0lHcWdJQkFRUVdGaFF5TURJMExUQTVMVEExVkRBMU9qTTRPalEzV2pBZkFnSUdyQUlCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREEyT2pFM09qSTNXakNDQVlVQ0FSRUNBUUVFZ2dGN01ZSUJkekFMQWdJR3JRSUJBUVFDREFBd0N3SUNCckFDQVFFRUFoWUFNQXNDQWdheUFnRUJCQUlNQURBTEFnSUdzd0lCQVFRQ0RBQXdDd0lDQnJRQ0FRRUVBZ3dBTUFzQ0FnYTFBZ0VCQkFJTUFEQUxBZ0lHdGdJQkFRUUNEQUF3REFJQ0JxVUNBUUVFQXdJQkFUQU1BZ0lHcXdJQkFRUURBZ0VETUF3Q0FnYXVBZ0VCQkFNQ0FRQXdEQUlDQnJFQ0FRRUVBd0lCQURBTUFnSUd0d0lCQVFRREFnRUFNQXdDQWdhNkFnRUJCQU1DQVFBd0VnSUNCcThDQVFFRUNRSUhCeHI5VGVqMmtUQVZBZ0lHcGdJQkFRUU1EQW8xTmpjeE5UYzFPREEyTUJzQ0FnYW5BZ0VCQkJJTUVESXdNREF3TURBM01EWXdOamt3T0RZd0d3SUNCcWtDQVFFRUVnd1FNakF3TURBd01EY3dOVFV4TkRNMU16QWZBZ0lHcUFJQkFRUVdGaFF5TURJMExUQTVMVEExVkRFeE9qVXlPalEzV2pBZkFnSUdxZ0lCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREExT2pNNE9qUTNXakFmQWdJR3JBSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZERXhPalUxT2pRM1dqQ0NBWVVDQVJFQ0FRRUVnZ0Y3TVlJQmR6QUxBZ0lHclFJQkFRUUNEQUF3Q3dJQ0JyQUNBUUVFQWhZQU1Bc0NBZ2F5QWdFQkJBSU1BREFMQWdJR3N3SUJBUVFDREFBd0N3SUNCclFDQVFFRUFnd0FNQXNDQWdhMUFnRUJCQUlNQURBTEFnSUd0Z0lCQVFRQ0RBQXdEQUlDQnFVQ0FRRUVBd0lCQVRBTUFnSUdxd0lCQVFRREFnRURNQXdDQWdhdUFnRUJCQU1DQVFBd0RBSUNCckVDQVFFRUF3SUJBREFNQWdJR3R3SUJBUVFEQWdFQU1Bd0NBZ2E2QWdFQkJBTUNBUUF3RWdJQ0JxOENBUUVFQ1FJSEJ4cjlUZW0yV0RBVkFnSUdwZ0lCQVFRTURBbzFOamN4TlRjMU9EQTJNQnNDQWdhbkFnRUJCQklNRURJd01EQXdNREEzTURZd056RTJOell3R3dJQ0Jxa0NBUUVFRWd3UU1qQXdNREF3TURjd05UVXhORE0xTXpBZkFnSUdxQUlCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREV4T2pVMU9qUTNXakFmQWdJR3FnSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZEQTFPak00T2pRM1dqQWZBZ0lHckFJQkFRUVdGaFF5TURJMExUQTVMVEExVkRFeE9qVTRPalEzV2pDQ0FZVUNBUkVDQVFFRWdnRjdNWUlCZHpBTEFnSUdyUUlCQVFRQ0RBQXdDd0lDQnJBQ0FRRUVBaFlBTUFzQ0FnYXlBZ0VCQkFJTUFEQUxBZ0lHc3dJQkFRUUNEQUF3Q3dJQ0JyUUNBUUVFQWd3QU1Bc0NBZ2ExQWdFQkJBSU1BREFMQWdJR3RnSUJBUVFDREFBd0RBSUNCcVVDQVFFRUF3SUJBVEFNQWdJR3F3SUJBUVFEQWdFRE1Bd0NBZ2F1QWdFQkJBTUNBUUF3REFJQ0JyRUNBUUVFQXdJQkFEQU1BZ0lHdHdJQkFRUURBZ0VBTUF3Q0FnYTZBZ0VCQkFNQ0FRQXdFZ0lDQnE4Q0FRRUVDUUlIQnhyOVRlbTNuekFWQWdJR3BnSUJBUVFNREFvMU5qY3hOVGMxT0RBMk1Cc0NBZ2FuQWdFQkJCSU1FREl3TURBd01EQTNNRFl3Tnpnek1qY3dHd0lDQnFrQ0FRRUVFZ3dRTWpBd01EQXdNRGN3TlRVeE5ETTFNekFmQWdJR3FBSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZERXlPakF4T2pFMldqQWZBZ0lHcWdJQkFRUVdGaFF5TURJMExUQTVMVEExVkRBMU9qTTRPalEzV2pBZkFnSUdyQUlCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREV5T2pBME9qRTJXakNDQVlVQ0FSRUNBUUVFZ2dGN01ZSUJkekFMQWdJR3JRSUJBUVFDREFBd0N3SUNCckFDQVFFRUFoWUFNQXNDQWdheUFnRUJCQUlNQURBTEFnSUdzd0lCQVFRQ0RBQXdDd0lDQnJRQ0FRRUVBZ3dBTUFzQ0FnYTFBZ0VCQkFJTUFEQUxBZ0lHdGdJQkFRUUNEQUF3REFJQ0JxVUNBUUVFQXdJQkFUQU1BZ0lHcXdJQkFRUURBZ0VETUF3Q0FnYXVBZ0VCQkFNQ0FRQXdEQUlDQnJFQ0FRRUVBd0lCQURBTUFnSUd0d0lCQVFRREFnRUFNQXdDQWdhNkFnRUJCQU1DQVFBd0VnSUNCcThDQVFFRUNRSUhCeHI5VGVtN0hUQVZBZ0lHcGdJQkFRUU1EQW8xTmpjeE5UYzFPREEyTUJzQ0FnYW5BZ0VCQkJJTUVESXdNREF3TURBM01EWXdPREV6TlRVd0d3SUNCcWtDQVFFRUVnd1FNakF3TURBd01EY3dOVFV4TkRNMU16QWZBZ0lHcUFJQkFRUVdGaFF5TURJMExUQTVMVEExVkRFeU9qQTBPakUyV2pBZkFnSUdxZ0lCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREExT2pNNE9qUTNXakFmQWdJR3JBSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZERXlPakEzT2pFMldqQ0NBWVVDQVJFQ0FRRUVnZ0Y3TVlJQmR6QUxBZ0lHclFJQkFRUUNEQUF3Q3dJQ0JyQUNBUUVFQWhZQU1Bc0NBZ2F5QWdFQkJBSU1BREFMQWdJR3N3SUJBUVFDREFBd0N3SUNCclFDQVFFRUFnd0FNQXNDQWdhMUFnRUJCQUlNQURBTEFnSUd0Z0lCQVFRQ0RBQXdEQUlDQnFVQ0FRRUVBd0lCQVRBTUFnSUdxd0lCQVFRREFnRURNQXdDQWdhdUFnRUJCQU1DQVFBd0RBSUNCckVDQVFFRUF3SUJBREFNQWdJR3R3SUJBUVFEQWdFQU1Bd0NBZ2E2QWdFQkJBTUNBUUF3RWdJQ0JxOENBUUVFQ1FJSEJ4cjlUZW04Z1RBVkFnSUdwZ0lCQVFRTURBbzFOamN4TlRjMU9EQTJNQnNDQWdhbkFnRUJCQklNRURJd01EQXdNREEzTURZd09ETTNPRE13R3dJQ0Jxa0NBUUVFRWd3UU1qQXdNREF3TURjd05UVXhORE0xTXpBZkFnSUdxQUlCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREV5T2pBM09qRTJXakFmQWdJR3FnSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZEQTFPak00T2pRM1dqQWZBZ0lHckFJQkFRUVdGaFF5TURJMExUQTVMVEExVkRFeU9qRXdPakUyV2pDQ0FZVUNBUkVDQVFFRWdnRjdNWUlCZHpBTEFnSUdyUUlCQVFRQ0RBQXdDd0lDQnJBQ0FRRUVBaFlBTUFzQ0FnYXlBZ0VCQkFJTUFEQUxBZ0lHc3dJQkFRUUNEQUF3Q3dJQ0JyUUNBUUVFQWd3QU1Bc0NBZ2ExQWdFQkJBSU1BREFMQWdJR3RnSUJBUVFDREFBd0RBSUNCcVVDQVFFRUF3SUJBVEFNQWdJR3F3SUJBUVFEQWdFRE1Bd0NBZ2F1QWdFQkJBTUNBUUF3REFJQ0JyRUNBUUVFQXdJQkFEQU1BZ0lHdHdJQkFRUURBZ0VBTUF3Q0FnYTZBZ0VCQkFNQ0FRQXdFZ0lDQnE4Q0FRRUVDUUlIQnhyOVRlbTk0REFWQWdJR3BnSUJBUVFNREFvMU5qY3hOVGMxT0RBMk1Cc0NBZ2FuQWdFQkJCSU1FREl3TURBd01EQTNNRFl3T0Rrek5EVXdHd0lDQnFrQ0FRRUVFZ3dRTWpBd01EQXdNRGN3TlRVeE5ETTFNekFmQWdJR3FBSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZERXlPakV3T2pFMldqQWZBZ0lHcWdJQkFRUVdGaFF5TURJMExUQTVMVEExVkRBMU9qTTRPalEzV2pBZkFnSUdyQUlCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREV5T2pFek9qRTJXakNDQVlVQ0FSRUNBUUVFZ2dGN01ZSUJkekFMQWdJR3JRSUJBUVFDREFBd0N3SUNCckFDQVFFRUFoWUFNQXNDQWdheUFnRUJCQUlNQURBTEFnSUdzd0lCQVFRQ0RBQXdDd0lDQnJRQ0FRRUVBZ3dBTUFzQ0FnYTFBZ0VCQkFJTUFEQUxBZ0lHdGdJQkFRUUNEQUF3REFJQ0JxVUNBUUVFQXdJQkFUQU1BZ0lHcXdJQkFRUURBZ0VETUF3Q0FnYXVBZ0VCQkFNQ0FRQXdEQUlDQnJFQ0FRRUVBd0lCQURBTUFnSUd0d0lCQVFRREFnRUFNQXdDQWdhNkFnRUJCQU1DQVFBd0VnSUNCcThDQVFFRUNRSUhCeHI5VGVtL21UQVZBZ0lHcGdJQkFRUU1EQW8xTmpjeE5UYzFPREEyTUJzQ0FnYW5BZ0VCQkJJTUVESXdNREF3TURBM01EWXdPVE15TXpRd0d3SUNCcWtDQVFFRUVnd1FNakF3TURBd01EY3dOVFV4TkRNMU16QWZBZ0lHcUFJQkFRUVdGaFF5TURJMExUQTVMVEExVkRFeU9qRXpPakUyV2pBZkFnSUdxZ0lCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREExT2pNNE9qUTNXakFmQWdJR3JBSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZERXlPakUyT2pFMldqQ0NBWVVDQVJFQ0FRRUVnZ0Y3TVlJQmR6QUxBZ0lHclFJQkFRUUNEQUF3Q3dJQ0JyQUNBUUVFQWhZQU1Bc0NBZ2F5QWdFQkJBSU1BREFMQWdJR3N3SUJBUVFDREFBd0N3SUNCclFDQVFFRUFnd0FNQXNDQWdhMUFnRUJCQUlNQURBTEFnSUd0Z0lCQVFRQ0RBQXdEQUlDQnFVQ0FRRUVBd0lCQVRBTUFnSUdxd0lCQVFRREFnRURNQXdDQWdhdUFnRUJCQU1DQVFBd0RBSUNCckVDQVFFRUF3SUJBREFNQWdJR3R3SUJBUVFEQWdFQU1Bd0NBZ2E2QWdFQkJBTUNBUUF3RWdJQ0JxOENBUUVFQ1FJSEJ4cjlUZW5CWERBVkFnSUdwZ0lCQVFRTURBbzFOamN4TlRjMU9EQTJNQnNDQWdhbkFnRUJCQklNRURJd01EQXdNREEzTURZd09UZ3pNVGN3R3dJQ0Jxa0NBUUVFRWd3UU1qQXdNREF3TURjd05UVXhORE0xTXpBZkFnSUdxQUlCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREV5T2pFMk9qRTJXakFmQWdJR3FnSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZEQTFPak00T2pRM1dqQWZBZ0lHckFJQkFRUVdGaFF5TURJMExUQTVMVEExVkRFeU9qRTVPakUyV3FDQ0R1SXdnZ1hHTUlJRXJxQURBZ0VDQWhBVjU1L09VbFVLWlFGOGtkL2s3ck5aTUEwR0NTcUdTSWIzRFFFQkN3VUFNSFV4UkRCQ0JnTlZCQU1NTzBGd2NHeGxJRmR2Y214a2QybGtaU0JFWlhabGJHOXdaWElnVW1Wc1lYUnBiMjV6SUVObGNuUnBabWxqWVhScGIyNGdRWFYwYUc5eWFYUjVNUXN3Q1FZRFZRUUxEQUpITlRFVE1CRUdBMVVFQ2d3S1FYQndiR1VnU1c1akxqRUxNQWtHQTFVRUJoTUNWVk13SGhjTk1qSXdPVEF5TVRreE16VTNXaGNOTWpReE1EQXhNVGt4TXpVMldqQ0JpVEUzTURVR0ExVUVBd3d1VFdGaklFRndjQ0JUZEc5eVpTQmhibVFnYVZSMWJtVnpJRk4wYjNKbElGSmxZMlZwY0hRZ1UybG5ibWx1WnpFc01Db0dBMVVFQ3d3alFYQndiR1VnVjI5eWJHUjNhV1JsSUVSbGRtVnNiM0JsY2lCU1pXeGhkR2x2Ym5NeEV6QVJCZ05WQkFvTUNrRndjR3hsSUVsdVl5NHhDekFKQmdOVkJBWVRBbFZUTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUF2RVRPQzYxcU1IYXZ3QWtNTkhvWlllKzlJQTMxK2tPZUUvV3M4enlURHRkbG0zVENXamNuVlBDT3pVWTZnc3gxdnhMZ0N5bnVXR3VnNTBJcTk0Y0FuNkxNcVNMbWJlZ041OHNQOU5Ca1c3Ty9qV1BOd3B0aXNDblgzc0NqamEwYnBQanJhTnR6aGk1ZnpMc2hmV3U0T0c2cjd5S0RTQlAyUktLa1JwemxZdXgwTzM4M2xLSjJhb2doZXdSOG9kT3pudUkxYmFlT2o3RGpaZGJJTXg5T2pvb0Q3T205ekIrMXA0YU9CUENRNzdvaGptMlNZbkxCaWRDWS91TlZ5VmJHTkhUKzlCNmFRM0JoZlg2R3dubmRVSFhkQ0xEa3FMVjZObjJYL1BsSklCM25FbUtvWmRvOEZsaitKbEdQa1htclBWdTcrUzdUTzFJSEdERG5mdytZN3dJREFRQUJvNElDT3pDQ0FqY3dEQVlEVlIwVEFRSC9CQUl3QURBZkJnTlZIU01FR0RBV2dCUVppNWVOU2x0aGVGZjBwVncxRW9vNUNPT3dkVEJ3QmdnckJnRUZCUWNCQVFSa01HSXdMUVlJS3dZQkJRVUhNQUtHSVdoMGRIQTZMeTlqWlhKMGN5NWhjSEJzWlM1amIyMHZkM2RrY21jMUxtUmxjakF4QmdnckJnRUZCUWN3QVlZbGFIUjBjRG92TDI5amMzQXVZWEJ3YkdVdVkyOXRMMjlqYzNBd015MTNkMlJ5WnpVd05UQ0NBUjhHQTFVZElBU0NBUll3Z2dFU01JSUJEZ1lLS29aSWh2ZGpaQVVHQVRDQi96QTNCZ2dyQmdFRkJRY0NBUllyYUhSMGNITTZMeTkzZDNjdVlYQndiR1V1WTI5dEwyTmxjblJwWm1sallYUmxZWFYwYUc5eWFYUjVMekNCd3dZSUt3WUJCUVVIQWdJd2diWU1nYk5TWld4cFlXNWpaU0J2YmlCMGFHbHpJR05sY25ScFptbGpZWFJsSUdKNUlHRnVlU0J3WVhKMGVTQmhjM04xYldWeklHRmpZMlZ3ZEdGdVkyVWdiMllnZEdobElIUm9aVzRnWVhCd2JHbGpZV0pzWlNCemRHRnVaR0Z5WkNCMFpYSnRjeUJoYm1RZ1kyOXVaR2wwYVc5dWN5QnZaaUIxYzJVc0lHTmxjblJwWm1sallYUmxJSEJ2YkdsamVTQmhibVFnWTJWeWRHbG1hV05oZEdsdmJpQndjbUZqZEdsalpTQnpkR0YwWlcxbGJuUnpMakF3QmdOVkhSOEVLVEFuTUNXZ0k2QWhoaDlvZEhSd09pOHZZM0pzTG1Gd2NHeGxMbU52YlM5M2QyUnlaelV1WTNKc01CMEdBMVVkRGdRV0JCUWl5VHg3WXhPRnZqbzd4VE9wdFBxeHNJS1RGekFPQmdOVkhROEJBZjhFQkFNQ0I0QXdFQVlLS29aSWh2ZGpaQVlMQVFRQ0JRQXdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBRHhHN3Mrb1BMajlub1BMVWZEMnFGSDg0Z2NkZ2lUYzdwS0tHK3BOcU9vN1Q0Y3ltams1MjF2NFc5cE5qYzM3Q1VvTHNjMmFHVzlPeC8xb1d6dmMrVmVQa3lSS2hIU05vQ1JuZHptQ09RMlBMM3lCZ1EvdDYxdjRkYlQ4ODk2VWtiMU1oUng5MFk1blpFaUNCZ3F3WVNURThGQXJWbHF1elc3QWQ0Qmh6d2p5b0ZIbGMva0JrUk5uTXY4emNUTTdNRTlMTUFWOExiTTVhOThtWGE5OHVYWUd1YTRMSDJWUVZRSE5vYk5QT1hFRU1jWklkUlVtUDByZkt1U0N5bzRZWmVsZ3NJNkc0dFpLMUhPWkpLMU9GVTV0UlVocnhnTzdkelJHblVmWHBHajNEM1JBUWpkNGhDaStBaXNLRG96ZVZrbWFVTTBDZVR1TTBEcW9yNWtjeW9Fd2dnUlZNSUlEUGFBREFnRUNBaFE3Zm9BSzd0TUNvZWJzMjVmWnlxd29uUEZwbERBTkJna3Foa2lHOXcwQkFRc0ZBREJpTVFzd0NRWURWUVFHRXdKVlV6RVRNQkVHQTFVRUNoTUtRWEJ3YkdVZ1NXNWpMakVtTUNRR0ExVUVDeE1kUVhCd2JHVWdRMlZ5ZEdsbWFXTmhkR2x2YmlCQmRYUm9iM0pwZEhreEZqQVVCZ05WQkFNVERVRndjR3hsSUZKdmIzUWdRMEV3SGhjTk1qQXhNakUyTVRrek9EVTJXaGNOTXpBeE1qRXdNREF3TURBd1dqQjFNVVF3UWdZRFZRUURERHRCY0hCc1pTQlhiM0pzWkhkcFpHVWdSR1YyWld4dmNHVnlJRkpsYkdGMGFXOXVjeUJEWlhKMGFXWnBZMkYwYVc5dUlFRjFkR2h2Y21sMGVURUxNQWtHQTFVRUN3d0NSelV4RXpBUkJnTlZCQW9NQ2tGd2NHeGxJRWx1WXk0eEN6QUpCZ05WQkFZVEFsVlRNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQW4xM2FIL3Y2dk5CTElqekgxaWI2Ri9mMG54NCtaQkZtbXU5ZXZxczB2YW9zSVc3V0hwUWhoU3gwd1E0UVlhbzhZMHArU3VQSWRkYlB3cHdJU0h0cXVTbXh5V2I5eUlvVzBiSUVQSUs2Z0d6aS93cHk2NnorTzI5SXZwNkxFVTJWZmJKN2tDOENIRTc4U2I3WGI3VlB2bmpHMnQ2eXpjblpaaEU3V3VrSlJYT0pVTlJPNG1nRmZ0cDFuRXNCcnRyanoyMTBUZDVUME5VYU9JSTYwSjNqWFNsN3NZSHFLU2NMKzJCOGhoTDc4R0pQQnVkTTBSL1piWjd0YzlwNElRMmRjTmxHVjVCZlo0VEJjM2NLcUdKaXRxNXdocnQxSTRtdGVmYm1wTlQ5Z3lZeUNqc2trbHNnb1p6Ukw0QVltOTA4QytlMS9leUFWdzhYbmo4cmh5ZTc5d0lEQVFBQm80SHZNSUhzTUJJR0ExVWRFd0VCL3dRSU1BWUJBZjhDQVFBd0h3WURWUjBqQkJnd0ZvQVVLOUJwUjVSMkNmNzBhNDB1UUtiM1IwMS9DRjR3UkFZSUt3WUJCUVVIQVFFRU9EQTJNRFFHQ0NzR0FRVUZCekFCaGlob2RIUndPaTh2YjJOemNDNWhjSEJzWlM1amIyMHZiMk56Y0RBekxXRndjR3hsY205dmRHTmhNQzRHQTFVZEh3UW5NQ1V3STZBaG9CK0dIV2gwZEhBNkx5OWpjbXd1WVhCd2JHVXVZMjl0TDNKdmIzUXVZM0pzTUIwR0ExVWREZ1FXQkJRWmk1ZU5TbHRoZUZmMHBWdzFFb281Q09Pd2RUQU9CZ05WSFE4QkFmOEVCQU1DQVFZd0VBWUtLb1pJaHZkalpBWUNBUVFDQlFBd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFGckVOYUxaNWdxZVVxSUFnaUozelhJdmtQa2lyeFFsektvS1FtQ1N3cjExSGV0TXloWGxmbXRBRUY3N1cwVjBEZkI2ZllpUnp0NWppMEtKMGhqZlFiTlluZ1lJaDBqZFFLOGoxZTNyTEdEbDY2Ui9IT21jZzlhVVgweGlPWXBPcmhPTmZVTzQzRjZzdmhoQTh1WVBMRjBUay9GN1phakNhRWplLzdTV213ejdNamFlbmcyVlh6Z0tpNWJTRW15M2l3dU8xejdzYndHcXprMUZZTnVFY1daaTVSbGxNTTJLLzBWVCsyNzdpSGREdzBoaitmZFJzM0plZWVKV3o3eTdoTGs0V25pdUVVaFN1dzAxaTVUZXpIU2FhUFZKWUpTczhxaXpGWWFRME13d1E0YlQ1WEFDVWJTQndLaVgxT3Jxc0l3SlFPODRrN0xOSWdQclowTmx5RVV3Z2dTN01JSURvNkFEQWdFQ0FnRUNNQTBHQ1NxR1NJYjNEUUVCQlFVQU1HSXhDekFKQmdOVkJBWVRBbFZUTVJNd0VRWURWUVFLRXdwQmNIQnNaU0JKYm1NdU1TWXdKQVlEVlFRTEV4MUJjSEJzWlNCRFpYSjBhV1pwWTJGMGFXOXVJRUYxZEdodmNtbDBlVEVXTUJRR0ExVUVBeE1OUVhCd2JHVWdVbTl2ZENCRFFUQWVGdzB3TmpBME1qVXlNVFF3TXpaYUZ3MHpOVEF5TURreU1UUXdNelphTUdJeEN6QUpCZ05WQkFZVEFsVlRNUk13RVFZRFZRUUtFd3BCY0hCc1pTQkpibU11TVNZd0pBWURWUVFMRXgxQmNIQnNaU0JEWlhKMGFXWnBZMkYwYVc5dUlFRjFkR2h2Y21sMGVURVdNQlFHQTFVRUF4TU5RWEJ3YkdVZ1VtOXZkQ0JEUVRDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBT1NScVFrZmtkc2VSMURyQmUxZWVZUXQ2emFpVjB4VjdJc1ppZDc1UzJ6MUI2c2lNQUxvR0Q3NFVBblRmMEdvbVBuUnltYWNKR3NSMEtPNzVCc3F3eCtWbm5vTXBFZUxXOVFXTnpQTHhBOU56aFJwMGNrWmN2VmREdFYvWDV2eUpRTzZWWTlOWFEzeFpEVWpGVXNWV1IyemxQZjJuSjdQVUxyQldGQm5qd2kwSVBmTHJDd2diM0MyUHdFd2pMZER6dytkUGZNclNTZ2F5UDdPdGJrTzJWNGMxc3M5dFRxdDlBOE9BSklMc1NFV0xuVFZQQTNiWWhhcm8zR1NSMU5Wd2E4dlFiUDQrK053emVhalRFVitIMHhyVUpaQmljUjBZZ3NRZzBHSE00cUJzVEJZN0ZvRU1veG9zNDhkM21Wei8yZGVaYnhKMkhhZk14UmxvWGVVeVMwQ0F3RUFBYU9DQVhvd2dnRjJNQTRHQTFVZER3RUIvd1FFQXdJQkJqQVBCZ05WSFJNQkFmOEVCVEFEQVFIL01CMEdBMVVkRGdRV0JCUXIwR2xIbEhZSi92UnJqUzVBcHZkSFRYOElYakFmQmdOVkhTTUVHREFXZ0JRcjBHbEhsSFlKL3ZScmpTNUFwdmRIVFg4SVhqQ0NBUkVHQTFVZElBU0NBUWd3Z2dFRU1JSUJBQVlKS29aSWh2ZGpaQVVCTUlIeU1Db0dDQ3NHQVFVRkJ3SUJGaDVvZEhSd2N6b3ZMM2QzZHk1aGNIQnNaUzVqYjIwdllYQndiR1ZqWVM4d2djTUdDQ3NHQVFVRkJ3SUNNSUcyR29HelVtVnNhV0Z1WTJVZ2IyNGdkR2hwY3lCalpYSjBhV1pwWTJGMFpTQmllU0JoYm5rZ2NHRnlkSGtnWVhOemRXMWxjeUJoWTJObGNIUmhibU5sSUc5bUlIUm9aU0IwYUdWdUlHRndjR3hwWTJGaWJHVWdjM1JoYm1SaGNtUWdkR1Z5YlhNZ1lXNWtJR052Ym1ScGRHbHZibk1nYjJZZ2RYTmxMQ0JqWlhKMGFXWnBZMkYwWlNCd2IyeHBZM2tnWVc1a0lHTmxjblJwWm1sallYUnBiMjRnY0hKaFkzUnBZMlVnYzNSaGRHVnRaVzUwY3k0d0RRWUpLb1pJaHZjTkFRRUZCUUFEZ2dFQkFGdzJtVXd0ZUxmdGpKdmM4M2ViOG5iU2R6QlB3UitGZzRVYm1UMUhOL0twbTBDT0xOU3hrQkxZdnZSem0rN1NaQS9MZVU4MDJLSSsrWGovYThnSDdIMDVnNHRUSU5NNHhMRy9tazhLYS84ci9GbW5CUWw4RjBCV0VSNTAwN2VMSXp0SG85VnZKT0xyMGJkdzN3OUY0U2ZLOFcxNDdlZTFGeGVvM0g0aU5jb2wxZGtQMW12VW9pUWpFZmVockk5emdXREdHMXNKTDVLeStFUkk4R0E0bmhYMVBTWm5JSW96YXZjTmdzL2U2Nk12K1ZOcVcyVEFZek4zOXpvSExGYnIyZzhoRHRxNmN4bFB0ZGsyZjhHSFZkbW5tYmt5UXZ2WTFYR2VmcUZTdHh1OWswSWtFaXJIRHgyMlRaeGVZOGhMZ0JkUXFvclYydVQ4MEFrSE43QjFkU0V4Z2dHMU1JSUJzUUlCQVRDQmlUQjFNVVF3UWdZRFZRUURERHRCY0hCc1pTQlhiM0pzWkhkcFpHVWdSR1YyWld4dmNHVnlJRkpsYkdGMGFXOXVjeUJEWlhKMGFXWnBZMkYwYVc5dUlFRjFkR2h2Y21sMGVURUxNQWtHQTFVRUN3d0NSelV4RXpBUkJnTlZCQW9NQ2tGd2NHeGxJRWx1WXk0eEN6QUpCZ05WQkFZVEFsVlRBaEFWNTUvT1VsVUtaUUY4a2QvazdyTlpNQTBHQ1dDR1NBRmxBd1FDQVFVQU1BMEdDU3FHU0liM0RRRUJBUVVBQklJQkFLQXNENlpVTnFYVDFQYXMyd055Q1ZBZHhoVjlORVlST3owYWVsNGhtOFdFWHE5Y2RYUlhtSElKcGZJSXNaRS9QS1NRMVdReDVDbjlzVlhrblVLOVkzV2tHTC80N3JxYjNuRG11SVhaRkFRVDZUMDd3S2tEWGpLbFNvcVBwS0FaVjJKeUhJUkowdlFFeWVFZkxwVldHZXByTWxqUWM3MWMxN2hTeXhXRWRjZmo2amk3Y0dkbHJZUnZXVTB4Y1VjcWJVdjEyNDQ3QzhKOTlEY0p3YmpJeHRhZHlRaEZOb0U2STNBcGdHTU8rL3poL2N4c2Q2WUUyaHBSZEp2Q252RTE0ODRqQU9LekJMR0QzMEJXY1llT1VaL3VEZWhOM3Y4WXpjdzREdmtBaFJxc1JRSVNmMGZwamN6WHBRNS9FbUtwd0ZUc1ZhWC96cU94TVk2eitWQXcvbE09';

        // Step 2: Send the receipt to Apple's servers for validation
        $response = $this->sendReceiptToApple($receiptData);

        // Step 3: Handle the response and check if the subscription is valid
        return $this->handleAppleResponse($response);
    }

    private function callAppleApi($url, $postData)
    {
        // Send the POST request with raw JSON data
        $response = Http::withHeaders([
            'Content-Type' => 'application/json',
        ])->post($url, $postData);

        // Return the JSON response
        return $response->json();
    }


    private function sendReceiptToApple($receiptData)
    {
        $postData = json_encode([
            'receipt-data' => $receiptData,
            'password' => '7f3ca98c91d643fe93fc5f796f8d73bc', // Fetch shared secret from config
        ]);

        // First, try verifying with the production URL
        $response = $this->callAppleApi($this->appleProductionUrl, $postData);

        // If status 21007 is returned, try the sandbox URL
        if (isset($response['status']) && $response['status'] == 21007) {
            $response = $this->callAppleApi($this->appleSandboxUrl, $postData);
        }

        return $response;
    }


    private function handleAppleResponse($response)
    {
        if (isset($response['status']) && $response['status'] == 0) {
            // The receipt is valid
            return response()->json([
                'success' => true,
                'message' => 'Subscription is valid.',
                'data' => $response,  // Optionally include receipt data here
            ], 200);
        } else {
            // Log the response details for debugging
            Log::error('Apple subscription validation failed', [
                'response' => $response,
                'error_code' => $response['status'] ?? 'Unknown',
            ]);

            // Return error response
            return response()->json([
                'success' => false,
                'message' => 'Subscription validation failed.',
                'error_code' => $response['status'] ?? 'Unknown',
            ], 400);
        }
    }





}
