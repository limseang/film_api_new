<?php

namespace App\Http\Controllers;

use App\Models\crf;
use App\Models\Subcript;
use App\Models\Supplier;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Http;
use Illuminate\Support\Facades\Log;

class SubcriptController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index()
    {
        try{
            $subcripts = Subcript::all();
            return $this->sendResponse($subcripts, );
        }
        catch (\Exception $e){
            return $this->sendError($e->getMessage());
        }
    }

    /**
     * Show the form for creating a new resource.
     */
    public function create(Request $request)
    {
        try{
            $subcript = new Subcript();
           $subcript->supplier_code = $request->supplier_code;
           if($subcript->supplier_code) {
               $supplier = Supplier::where('supplier_code', $subcript->supplier_code)->first();
               if (!$supplier) {
                   return $this->sendError('Supplier not found');
               }
           }

            $subcript->name = $request->name;
            $subcript->duration = $request->duration;
            $subcript->price = $request->price;
            $subcript->description = $request->description;
            $subcript->status = $request->status;
            $subcript->supplier_code = $request->supplier_code;
            $subcript->uuid = rand(1000000000, 9999999999);
            $subcript->save();
            //random 10 digit uuid
            return $this->sendResponse($subcript, );
        }
        catch (\Exception $e) {
            return $this->sendError($e->getMessage());
        }
    }

    /**
     * Store a newly created resource in storage.
     */
    public function store(Request $request)
    {
        //
    }

    /**
     * Display the specified resource.
     */
    public function show(crf $crf)
    {
        //
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit(crf $crf)
    {
        //
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, crf $crf)
    {
        //
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy($id)
    {
        try{
            $subcript = Subcript::find($id);
            $subcript->delete();
            return $this->sendResponse($subcript);
        }
        catch (\Exception $e){
            return $this->sendError($e->getMessage());
        }
    }

    private $appleSandboxUrl = 'https://sandbox.itunes.apple.com/verifyReceipt';
    private $appleProductionUrl = 'https://buy.itunes.apple.com/verifyReceipt';

    public function verifySubscription(Request $request)
    {
        // Step 1: Validate the request


        $receiptData = 'TUlJdjBRWUpLb1pJaHZjTkFRY0NvSUl2d2pDQ0w3NENBUUV4RHpBTkJnbGdoa2dCWlFNRUFnRUZBRENDSHdjR0NTcUdTSWIzRFFFSEFhQ0NIdmdFZ2g3ME1ZSWU4REFLQWdFSUFnRUJCQUlXQURBS0FnRVVBZ0VCQkFJTUFEQUxBZ0VCQWdFQkJBTUNBUUF3Q3dJQkF3SUJBUVFEREFFeE1Bc0NBUXNDQVFFRUF3SUJBREFMQWdFUEFnRUJCQU1DQVFBd0N3SUJFQUlCQVFRREFnRUFNQXNDQVJrQ0FRRUVBd0lCQXpBTUFnRUtBZ0VCQkFRV0FqUXJNQXdDQVE0Q0FRRUVCQUlDQVJzd0RRSUJEUUlCQVFRRkFnTUN2eUF3RFFJQkV3SUJBUVFGREFNeExqQXdEZ0lCQ1FJQkFRUUdBZ1JRTXpBME1CZ0NBUVFDQVFJRUVFVkpRTHJQdDBobVgwUzJvNlRSOUgwd0dnSUJBZ0lCQVFRU0RCQmphVzVsYldGbmFXTnJhQzV1Wlhkek1Cc0NBUUFDQVFFRUV3d1JVSEp2WkhWamRHbHZibE5oYm1SaWIzZ3dIQUlCQlFJQkFRUVVzanp2dFkzVmxHbkJzZjNQQVREZm9DeGg5Sll3SGdJQkRBSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZERXlPakV3T2pJeFdqQWVBZ0VTQWdFQkJCWVdGREl3TVRNdE1EZ3RNREZVTURjNk1EQTZNREJhTUQwQ0FRY0NBUUVFTldod1dZRkcxNEJOcm8wem9aaDNHc2dpcGFKdWJheFdEdHV5dFNVRHFUNkJWb292U0s0OEoxZ1phcG1YRStrUmUyYytDQldPTUV3Q0FRWUNBUUVFUkNuVkhOQlNoVmZqai9sWW4xY0tMbGd6OXNFRGJqQWhySUVsRFFSNnBSSXNva2pWYkJXcHptMlpQeVVKeGxnbUs3NEE3cHJodnVPZUV0SXhIcWFyTEMzekxiVE9NSUlCWEFJQkVRSUJBUVNDQVZJeGdnRk9NQXNDQWdhc0FnRUJCQUlXQURBTEFnSUdyUUlCQVFRQ0RBQXdDd0lDQnJBQ0FRRUVBaFlBTUFzQ0FnYXlBZ0VCQkFJTUFEQUxBZ0lHc3dJQkFRUUNEQUF3Q3dJQ0JyUUNBUUVFQWd3QU1Bc0NBZ2ExQWdFQkJBSU1BREFMQWdJR3RnSUJBUVFDREFBd0RBSUNCcVVDQVFFRUF3SUJBVEFNQWdJR3F3SUJBUVFEQWdFQk1Bd0NBZ2F1QWdFQkJBTUNBUUF3REFJQ0JxOENBUUVFQXdJQkFEQU1BZ0lHc1FJQkFRUURBZ0VBTUF3Q0FnYTZBZ0VCQkFNQ0FRQXdGQUlDQnFZQ0FRRUVDd3dKTURBd01EQXdNREF4TUJzQ0FnYW5BZ0VCQkJJTUVESXdNREF3TURBM01EWXdPVEF3Tnpjd0d3SUNCcWtDQVFFRUVnd1FNakF3TURBd01EY3dOakE1TURBM056QWZBZ0lHcUFJQkFRUVdGaFF5TURJMExUQTVMVEExVkRFeU9qRXdPakl4V2pBZkFnSUdxZ0lCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREV5T2pFd09qSXhXakNDQVlVQ0FSRUNBUUVFZ2dGN01ZSUJkekFMQWdJR3JRSUJBUVFDREFBd0N3SUNCckFDQVFFRUFoWUFNQXNDQWdheUFnRUJCQUlNQURBTEFnSUdzd0lCQVFRQ0RBQXdDd0lDQnJRQ0FRRUVBZ3dBTUFzQ0FnYTFBZ0VCQkFJTUFEQUxBZ0lHdGdJQkFRUUNEQUF3REFJQ0JxVUNBUUVFQXdJQkFUQU1BZ0lHcXdJQkFRUURBZ0VETUF3Q0FnYXVBZ0VCQkFNQ0FRQXdEQUlDQnJFQ0FRRUVBd0lCQURBTUFnSUd0d0lCQVFRREFnRUFNQXdDQWdhNkFnRUJCQU1DQVFBd0VnSUNCcThDQVFFRUNRSUhCeHI5VGVqcCtUQVZBZ0lHcGdJQkFRUU1EQW8xTmpjeE5UYzFPREEyTUJzQ0FnYW5BZ0VCQkJJTUVESXdNREF3TURBM01EVTFNVFF6TlRNd0d3SUNCcWtDQVFFRUVnd1FNakF3TURBd01EY3dOVFV4TkRNMU16QWZBZ0lHcUFJQkFRUVdGaFF5TURJMExUQTVMVEExVkRBMU9qTTRPalEyV2pBZkFnSUdxZ0lCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREExT2pNNE9qUTNXakFmQWdJR3JBSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZEQTFPalF4T2pRMldqQ0NBWVVDQVJFQ0FRRUVnZ0Y3TVlJQmR6QUxBZ0lHclFJQkFRUUNEQUF3Q3dJQ0JyQUNBUUVFQWhZQU1Bc0NBZ2F5QWdFQkJBSU1BREFMQWdJR3N3SUJBUVFDREFBd0N3SUNCclFDQVFFRUFnd0FNQXNDQWdhMUFnRUJCQUlNQURBTEFnSUd0Z0lCQVFRQ0RBQXdEQUlDQnFVQ0FRRUVBd0lCQVRBTUFnSUdxd0lCQVFRREFnRURNQXdDQWdhdUFnRUJCQU1DQVFBd0RBSUNCckVDQVFFRUF3SUJBREFNQWdJR3R3SUJBUVFEQWdFQU1Bd0NBZ2E2QWdFQkJBTUNBUUF3RWdJQ0JxOENBUUVFQ1FJSEJ4cjlUZWpwK2pBVkFnSUdwZ0lCQVFRTURBbzFOamN4TlRjMU9EQTJNQnNDQWdhbkFnRUJCQklNRURJd01EQXdNREEzTURVMU1qQXhPVGd3R3dJQ0Jxa0NBUUVFRWd3UU1qQXdNREF3TURjd05UVXhORE0xTXpBZkFnSUdxQUlCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREExT2pRME9qSTNXakFmQWdJR3FnSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZEQTFPak00T2pRM1dqQWZBZ0lHckFJQkFRUVdGaFF5TURJMExUQTVMVEExVkRBMU9qUTNPakkzV2pDQ0FZVUNBUkVDQVFFRWdnRjdNWUlCZHpBTEFnSUdyUUlCQVFRQ0RBQXdDd0lDQnJBQ0FRRUVBaFlBTUFzQ0FnYXlBZ0VCQkFJTUFEQUxBZ0lHc3dJQkFRUUNEQUF3Q3dJQ0JyUUNBUUVFQWd3QU1Bc0NBZ2ExQWdFQkJBSU1BREFMQWdJR3RnSUJBUVFDREFBd0RBSUNCcVVDQVFFRUF3SUJBVEFNQWdJR3F3SUJBUVFEQWdFRE1Bd0NBZ2F1QWdFQkJBTUNBUUF3REFJQ0JyRUNBUUVFQXdJQkFEQU1BZ0lHdHdJQkFRUURBZ0VBTUF3Q0FnYTZBZ0VCQkFNQ0FRQXdFZ0lDQnE4Q0FRRUVDUUlIQnhyOVRlanI1VEFWQWdJR3BnSUJBUVFNREFvMU5qY3hOVGMxT0RBMk1Cc0NBZ2FuQWdFQkJCSU1FREl3TURBd01EQTNNRFUxTWpFNE1EUXdHd0lDQnFrQ0FRRUVFZ3dRTWpBd01EQXdNRGN3TlRVeE5ETTFNekFmQWdJR3FBSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZEQTFPalEzT2pJM1dqQWZBZ0lHcWdJQkFRUVdGaFF5TURJMExUQTVMVEExVkRBMU9qTTRPalEzV2pBZkFnSUdyQUlCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREExT2pVd09qSTNXakNDQVlVQ0FSRUNBUUVFZ2dGN01ZSUJkekFMQWdJR3JRSUJBUVFDREFBd0N3SUNCckFDQVFFRUFoWUFNQXNDQWdheUFnRUJCQUlNQURBTEFnSUdzd0lCQVFRQ0RBQXdDd0lDQnJRQ0FRRUVBZ3dBTUFzQ0FnYTFBZ0VCQkFJTUFEQUxBZ0lHdGdJQkFRUUNEQUF3REFJQ0JxVUNBUUVFQXdJQkFUQU1BZ0lHcXdJQkFRUURBZ0VETUF3Q0FnYXVBZ0VCQkFNQ0FRQXdEQUlDQnJFQ0FRRUVBd0lCQURBTUFnSUd0d0lCQVFRREFnRUFNQXdDQWdhNkFnRUJCQU1DQVFBd0VnSUNCcThDQVFFRUNRSUhCeHI5VGVqc216QVZBZ0lHcGdJQkFRUU1EQW8xTmpjeE5UYzFPREEyTUJzQ0FnYW5BZ0VCQkJJTUVESXdNREF3TURBM01EVTFNalV3TmpFd0d3SUNCcWtDQVFFRUVnd1FNakF3TURBd01EY3dOVFV4TkRNMU16QWZBZ0lHcUFJQkFRUVdGaFF5TURJMExUQTVMVEExVkRBMU9qVXdPakkzV2pBZkFnSUdxZ0lCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREExT2pNNE9qUTNXakFmQWdJR3JBSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZEQTFPalV6T2pJM1dqQ0NBWVVDQVJFQ0FRRUVnZ0Y3TVlJQmR6QUxBZ0lHclFJQkFRUUNEQUF3Q3dJQ0JyQUNBUUVFQWhZQU1Bc0NBZ2F5QWdFQkJBSU1BREFMQWdJR3N3SUJBUVFDREFBd0N3SUNCclFDQVFFRUFnd0FNQXNDQWdhMUFnRUJCQUlNQURBTEFnSUd0Z0lCQVFRQ0RBQXdEQUlDQnFVQ0FRRUVBd0lCQVRBTUFnSUdxd0lCQVFRREFnRURNQXdDQWdhdUFnRUJCQU1DQVFBd0RBSUNCckVDQVFFRUF3SUJBREFNQWdJR3R3SUJBUVFEQWdFQU1Bd0NBZ2E2QWdFQkJBTUNBUUF3RWdJQ0JxOENBUUVFQ1FJSEJ4cjlUZWp0bWpBVkFnSUdwZ0lCQVFRTURBbzFOamN4TlRjMU9EQTJNQnNDQWdhbkFnRUJCQklNRURJd01EQXdNREEzTURVMU1qWTJOamN3R3dJQ0Jxa0NBUUVFRWd3UU1qQXdNREF3TURjd05UVXhORE0xTXpBZkFnSUdxQUlCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREExT2pVek9qSTNXakFmQWdJR3FnSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZEQTFPak00T2pRM1dqQWZBZ0lHckFJQkFRUVdGaFF5TURJMExUQTVMVEExVkRBMU9qVTJPakkzV2pDQ0FZVUNBUkVDQVFFRWdnRjdNWUlCZHpBTEFnSUdyUUlCQVFRQ0RBQXdDd0lDQnJBQ0FRRUVBaFlBTUFzQ0FnYXlBZ0VCQkFJTUFEQUxBZ0lHc3dJQkFRUUNEQUF3Q3dJQ0JyUUNBUUVFQWd3QU1Bc0NBZ2ExQWdFQkJBSU1BREFMQWdJR3RnSUJBUVFDREFBd0RBSUNCcVVDQVFFRUF3SUJBVEFNQWdJR3F3SUJBUVFEQWdFRE1Bd0NBZ2F1QWdFQkJBTUNBUUF3REFJQ0JyRUNBUUVFQXdJQkFEQU1BZ0lHdHdJQkFRUURBZ0VBTUF3Q0FnYTZBZ0VCQkFNQ0FRQXdFZ0lDQnE4Q0FRRUVDUUlIQnhyOVRlanVvVEFWQWdJR3BnSUJBUVFNREFvMU5qY3hOVGMxT0RBMk1Cc0NBZ2FuQWdFQkJCSU1FREl3TURBd01EQTNNRFUxTXpBeU5qa3dHd0lDQnFrQ0FRRUVFZ3dRTWpBd01EQXdNRGN3TlRVeE5ETTFNekFmQWdJR3FBSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZEQTFPalUyT2pJM1dqQWZBZ0lHcWdJQkFRUVdGaFF5TURJMExUQTVMVEExVkRBMU9qTTRPalEzV2pBZkFnSUdyQUlCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREExT2pVNU9qSTNXakNDQVlVQ0FSRUNBUUVFZ2dGN01ZSUJkekFMQWdJR3JRSUJBUVFDREFBd0N3SUNCckFDQVFFRUFoWUFNQXNDQWdheUFnRUJCQUlNQURBTEFnSUdzd0lCQVFRQ0RBQXdDd0lDQnJRQ0FRRUVBZ3dBTUFzQ0FnYTFBZ0VCQkFJTUFEQUxBZ0lHdGdJQkFRUUNEQUF3REFJQ0JxVUNBUUVFQXdJQkFUQU1BZ0lHcXdJQkFRUURBZ0VETUF3Q0FnYXVBZ0VCQkFNQ0FRQXdEQUlDQnJFQ0FRRUVBd0lCQURBTUFnSUd0d0lCQVFRREFnRUFNQXdDQWdhNkFnRUJCQU1DQVFBd0VnSUNCcThDQVFFRUNRSUhCeHI5VGVqdnBEQVZBZ0lHcGdJQkFRUU1EQW8xTmpjeE5UYzFPREEyTUJzQ0FnYW5BZ0VCQkJJTUVESXdNREF3TURBM01EVTFNelUyTXpnd0d3SUNCcWtDQVFFRUVnd1FNakF3TURBd01EY3dOVFV4TkRNMU16QWZBZ0lHcUFJQkFRUVdGaFF5TURJMExUQTVMVEExVkRBMU9qVTVPakkzV2pBZkFnSUdxZ0lCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREExT2pNNE9qUTNXakFmQWdJR3JBSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZEQTJPakF5T2pJM1dqQ0NBWVVDQVJFQ0FRRUVnZ0Y3TVlJQmR6QUxBZ0lHclFJQkFRUUNEQUF3Q3dJQ0JyQUNBUUVFQWhZQU1Bc0NBZ2F5QWdFQkJBSU1BREFMQWdJR3N3SUJBUVFDREFBd0N3SUNCclFDQVFFRUFnd0FNQXNDQWdhMUFnRUJCQUlNQURBTEFnSUd0Z0lCQVFRQ0RBQXdEQUlDQnFVQ0FRRUVBd0lCQVRBTUFnSUdxd0lCQVFRREFnRURNQXdDQWdhdUFnRUJCQU1DQVFBd0RBSUNCckVDQVFFRUF3SUJBREFNQWdJR3R3SUJBUVFEQWdFQU1Bd0NBZ2E2QWdFQkJBTUNBUUF3RWdJQ0JxOENBUUVFQ1FJSEJ4cjlUZWp3blRBVkFnSUdwZ0lCQVFRTURBbzFOamN4TlRjMU9EQTJNQnNDQWdhbkFnRUJCQklNRURJd01EQXdNREEzTURVMU16ZzROREF3R3dJQ0Jxa0NBUUVFRWd3UU1qQXdNREF3TURjd05UVXhORE0xTXpBZkFnSUdxQUlCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREEyT2pBeU9qSTNXakFmQWdJR3FnSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZEQTFPak00T2pRM1dqQWZBZ0lHckFJQkFRUVdGaFF5TURJMExUQTVMVEExVkRBMk9qQTFPakkzV2pDQ0FZVUNBUkVDQVFFRWdnRjdNWUlCZHpBTEFnSUdyUUlCQVFRQ0RBQXdDd0lDQnJBQ0FRRUVBaFlBTUFzQ0FnYXlBZ0VCQkFJTUFEQUxBZ0lHc3dJQkFRUUNEQUF3Q3dJQ0JyUUNBUUVFQWd3QU1Bc0NBZ2ExQWdFQkJBSU1BREFMQWdJR3RnSUJBUVFDREFBd0RBSUNCcVVDQVFFRUF3SUJBVEFNQWdJR3F3SUJBUVFEQWdFRE1Bd0NBZ2F1QWdFQkJBTUNBUUF3REFJQ0JyRUNBUUVFQXdJQkFEQU1BZ0lHdHdJQkFRUURBZ0VBTUF3Q0FnYTZBZ0VCQkFNQ0FRQXdFZ0lDQnE4Q0FRRUVDUUlIQnhyOVRlanh1akFWQWdJR3BnSUJBUVFNREFvMU5qY3hOVGMxT0RBMk1Cc0NBZ2FuQWdFQkJCSU1FREl3TURBd01EQTNNRFUxTkRJek9UQXdHd0lDQnFrQ0FRRUVFZ3dRTWpBd01EQXdNRGN3TlRVeE5ETTFNekFmQWdJR3FBSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZEQTJPakExT2pJM1dqQWZBZ0lHcWdJQkFRUVdGaFF5TURJMExUQTVMVEExVkRBMU9qTTRPalEzV2pBZkFnSUdyQUlCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREEyT2pBNE9qSTNXakNDQVlVQ0FSRUNBUUVFZ2dGN01ZSUJkekFMQWdJR3JRSUJBUVFDREFBd0N3SUNCckFDQVFFRUFoWUFNQXNDQWdheUFnRUJCQUlNQURBTEFnSUdzd0lCQVFRQ0RBQXdDd0lDQnJRQ0FRRUVBZ3dBTUFzQ0FnYTFBZ0VCQkFJTUFEQUxBZ0lHdGdJQkFRUUNEQUF3REFJQ0JxVUNBUUVFQXdJQkFUQU1BZ0lHcXdJQkFRUURBZ0VETUF3Q0FnYXVBZ0VCQkFNQ0FRQXdEQUlDQnJFQ0FRRUVBd0lCQURBTUFnSUd0d0lCQVFRREFnRUFNQXdDQWdhNkFnRUJCQU1DQVFBd0VnSUNCcThDQVFFRUNRSUhCeHI5VGVqeTdqQVZBZ0lHcGdJQkFRUU1EQW8xTmpjeE5UYzFPREEyTUJzQ0FnYW5BZ0VCQkJJTUVESXdNREF3TURBM01EVTFORGN5T0RRd0d3SUNCcWtDQVFFRUVnd1FNakF3TURBd01EY3dOVFV4TkRNMU16QWZBZ0lHcUFJQkFRUVdGaFF5TURJMExUQTVMVEExVkRBMk9qQTRPakkzV2pBZkFnSUdxZ0lCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREExT2pNNE9qUTNXakFmQWdJR3JBSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZEQTJPakV4T2pJM1dqQ0NBWVVDQVJFQ0FRRUVnZ0Y3TVlJQmR6QUxBZ0lHclFJQkFRUUNEQUF3Q3dJQ0JyQUNBUUVFQWhZQU1Bc0NBZ2F5QWdFQkJBSU1BREFMQWdJR3N3SUJBUVFDREFBd0N3SUNCclFDQVFFRUFnd0FNQXNDQWdhMUFnRUJCQUlNQURBTEFnSUd0Z0lCQVFRQ0RBQXdEQUlDQnFVQ0FRRUVBd0lCQVRBTUFnSUdxd0lCQVFRREFnRURNQXdDQWdhdUFnRUJCQU1DQVFBd0RBSUNCckVDQVFFRUF3SUJBREFNQWdJR3R3SUJBUVFEQWdFQU1Bd0NBZ2E2QWdFQkJBTUNBUUF3RWdJQ0JxOENBUUVFQ1FJSEJ4cjlUZWowSHpBVkFnSUdwZ0lCQVFRTURBbzFOamN4TlRjMU9EQTJNQnNDQWdhbkFnRUJCQklNRURJd01EQXdNREEzTURVMU5UQTRNVE13R3dJQ0Jxa0NBUUVFRWd3UU1qQXdNREF3TURjd05UVXhORE0xTXpBZkFnSUdxQUlCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREEyT2pFeE9qSTNXakFmQWdJR3FnSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZEQTFPak00T2pRM1dqQWZBZ0lHckFJQkFRUVdGaFF5TURJMExUQTVMVEExVkRBMk9qRTBPakkzV2pDQ0FZVUNBUkVDQVFFRWdnRjdNWUlCZHpBTEFnSUdyUUlCQVFRQ0RBQXdDd0lDQnJBQ0FRRUVBaFlBTUFzQ0FnYXlBZ0VCQkFJTUFEQUxBZ0lHc3dJQkFRUUNEQUF3Q3dJQ0JyUUNBUUVFQWd3QU1Bc0NBZ2ExQWdFQkJBSU1BREFMQWdJR3RnSUJBUVFDREFBd0RBSUNCcVVDQVFFRUF3SUJBVEFNQWdJR3F3SUJBUVFEQWdFRE1Bd0NBZ2F1QWdFQkJBTUNBUUF3REFJQ0JyRUNBUUVFQXdJQkFEQU1BZ0lHdHdJQkFRUURBZ0VBTUF3Q0FnYTZBZ0VCQkFNQ0FRQXdFZ0lDQnE4Q0FRRUVDUUlIQnhyOVRlajFZREFWQWdJR3BnSUJBUVFNREFvMU5qY3hOVGMxT0RBMk1Cc0NBZ2FuQWdFQkJCSU1FREl3TURBd01EQTNNRFUxTlRNME1qZ3dHd0lDQnFrQ0FRRUVFZ3dRTWpBd01EQXdNRGN3TlRVeE5ETTFNekFmQWdJR3FBSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZEQTJPakUwT2pJM1dqQWZBZ0lHcWdJQkFRUVdGaFF5TURJMExUQTVMVEExVkRBMU9qTTRPalEzV2pBZkFnSUdyQUlCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREEyT2pFM09qSTNXakNDQVlVQ0FSRUNBUUVFZ2dGN01ZSUJkekFMQWdJR3JRSUJBUVFDREFBd0N3SUNCckFDQVFFRUFoWUFNQXNDQWdheUFnRUJCQUlNQURBTEFnSUdzd0lCQVFRQ0RBQXdDd0lDQnJRQ0FRRUVBZ3dBTUFzQ0FnYTFBZ0VCQkFJTUFEQUxBZ0lHdGdJQkFRUUNEQUF3REFJQ0JxVUNBUUVFQXdJQkFUQU1BZ0lHcXdJQkFRUURBZ0VETUF3Q0FnYXVBZ0VCQkFNQ0FRQXdEQUlDQnJFQ0FRRUVBd0lCQURBTUFnSUd0d0lCQVFRREFnRUFNQXdDQWdhNkFnRUJCQU1DQVFBd0VnSUNCcThDQVFFRUNRSUhCeHI5VGVqMmtUQVZBZ0lHcGdJQkFRUU1EQW8xTmpjeE5UYzFPREEyTUJzQ0FnYW5BZ0VCQkJJTUVESXdNREF3TURBM01EWXdOamt3T0RZd0d3SUNCcWtDQVFFRUVnd1FNakF3TURBd01EY3dOVFV4TkRNMU16QWZBZ0lHcUFJQkFRUVdGaFF5TURJMExUQTVMVEExVkRFeE9qVXlPalEzV2pBZkFnSUdxZ0lCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREExT2pNNE9qUTNXakFmQWdJR3JBSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZERXhPalUxT2pRM1dqQ0NBWVVDQVJFQ0FRRUVnZ0Y3TVlJQmR6QUxBZ0lHclFJQkFRUUNEQUF3Q3dJQ0JyQUNBUUVFQWhZQU1Bc0NBZ2F5QWdFQkJBSU1BREFMQWdJR3N3SUJBUVFDREFBd0N3SUNCclFDQVFFRUFnd0FNQXNDQWdhMUFnRUJCQUlNQURBTEFnSUd0Z0lCQVFRQ0RBQXdEQUlDQnFVQ0FRRUVBd0lCQVRBTUFnSUdxd0lCQVFRREFnRURNQXdDQWdhdUFnRUJCQU1DQVFBd0RBSUNCckVDQVFFRUF3SUJBREFNQWdJR3R3SUJBUVFEQWdFQU1Bd0NBZ2E2QWdFQkJBTUNBUUF3RWdJQ0JxOENBUUVFQ1FJSEJ4cjlUZW0yV0RBVkFnSUdwZ0lCQVFRTURBbzFOamN4TlRjMU9EQTJNQnNDQWdhbkFnRUJCQklNRURJd01EQXdNREEzTURZd056RTJOell3R3dJQ0Jxa0NBUUVFRWd3UU1qQXdNREF3TURjd05UVXhORE0xTXpBZkFnSUdxQUlCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREV4T2pVMU9qUTNXakFmQWdJR3FnSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZEQTFPak00T2pRM1dqQWZBZ0lHckFJQkFRUVdGaFF5TURJMExUQTVMVEExVkRFeE9qVTRPalEzV2pDQ0FZVUNBUkVDQVFFRWdnRjdNWUlCZHpBTEFnSUdyUUlCQVFRQ0RBQXdDd0lDQnJBQ0FRRUVBaFlBTUFzQ0FnYXlBZ0VCQkFJTUFEQUxBZ0lHc3dJQkFRUUNEQUF3Q3dJQ0JyUUNBUUVFQWd3QU1Bc0NBZ2ExQWdFQkJBSU1BREFMQWdJR3RnSUJBUVFDREFBd0RBSUNCcVVDQVFFRUF3SUJBVEFNQWdJR3F3SUJBUVFEQWdFRE1Bd0NBZ2F1QWdFQkJBTUNBUUF3REFJQ0JyRUNBUUVFQXdJQkFEQU1BZ0lHdHdJQkFRUURBZ0VBTUF3Q0FnYTZBZ0VCQkFNQ0FRQXdFZ0lDQnE4Q0FRRUVDUUlIQnhyOVRlbTNuekFWQWdJR3BnSUJBUVFNREFvMU5qY3hOVGMxT0RBMk1Cc0NBZ2FuQWdFQkJCSU1FREl3TURBd01EQTNNRFl3Tnpnek1qY3dHd0lDQnFrQ0FRRUVFZ3dRTWpBd01EQXdNRGN3TlRVeE5ETTFNekFmQWdJR3FBSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZERXlPakF4T2pFMldqQWZBZ0lHcWdJQkFRUVdGaFF5TURJMExUQTVMVEExVkRBMU9qTTRPalEzV2pBZkFnSUdyQUlCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREV5T2pBME9qRTJXakNDQVlVQ0FSRUNBUUVFZ2dGN01ZSUJkekFMQWdJR3JRSUJBUVFDREFBd0N3SUNCckFDQVFFRUFoWUFNQXNDQWdheUFnRUJCQUlNQURBTEFnSUdzd0lCQVFRQ0RBQXdDd0lDQnJRQ0FRRUVBZ3dBTUFzQ0FnYTFBZ0VCQkFJTUFEQUxBZ0lHdGdJQkFRUUNEQUF3REFJQ0JxVUNBUUVFQXdJQkFUQU1BZ0lHcXdJQkFRUURBZ0VETUF3Q0FnYXVBZ0VCQkFNQ0FRQXdEQUlDQnJFQ0FRRUVBd0lCQURBTUFnSUd0d0lCQVFRREFnRUFNQXdDQWdhNkFnRUJCQU1DQVFBd0VnSUNCcThDQVFFRUNRSUhCeHI5VGVtN0hUQVZBZ0lHcGdJQkFRUU1EQW8xTmpjeE5UYzFPREEyTUJzQ0FnYW5BZ0VCQkJJTUVESXdNREF3TURBM01EWXdPREV6TlRVd0d3SUNCcWtDQVFFRUVnd1FNakF3TURBd01EY3dOVFV4TkRNMU16QWZBZ0lHcUFJQkFRUVdGaFF5TURJMExUQTVMVEExVkRFeU9qQTBPakUyV2pBZkFnSUdxZ0lCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREExT2pNNE9qUTNXakFmQWdJR3JBSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZERXlPakEzT2pFMldqQ0NBWVVDQVJFQ0FRRUVnZ0Y3TVlJQmR6QUxBZ0lHclFJQkFRUUNEQUF3Q3dJQ0JyQUNBUUVFQWhZQU1Bc0NBZ2F5QWdFQkJBSU1BREFMQWdJR3N3SUJBUVFDREFBd0N3SUNCclFDQVFFRUFnd0FNQXNDQWdhMUFnRUJCQUlNQURBTEFnSUd0Z0lCQVFRQ0RBQXdEQUlDQnFVQ0FRRUVBd0lCQVRBTUFnSUdxd0lCQVFRREFnRURNQXdDQWdhdUFnRUJCQU1DQVFBd0RBSUNCckVDQVFFRUF3SUJBREFNQWdJR3R3SUJBUVFEQWdFQU1Bd0NBZ2E2QWdFQkJBTUNBUUF3RWdJQ0JxOENBUUVFQ1FJSEJ4cjlUZW04Z1RBVkFnSUdwZ0lCQVFRTURBbzFOamN4TlRjMU9EQTJNQnNDQWdhbkFnRUJCQklNRURJd01EQXdNREEzTURZd09ETTNPRE13R3dJQ0Jxa0NBUUVFRWd3UU1qQXdNREF3TURjd05UVXhORE0xTXpBZkFnSUdxQUlCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREV5T2pBM09qRTJXakFmQWdJR3FnSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZEQTFPak00T2pRM1dqQWZBZ0lHckFJQkFRUVdGaFF5TURJMExUQTVMVEExVkRFeU9qRXdPakUyV2pDQ0FZVUNBUkVDQVFFRWdnRjdNWUlCZHpBTEFnSUdyUUlCQVFRQ0RBQXdDd0lDQnJBQ0FRRUVBaFlBTUFzQ0FnYXlBZ0VCQkFJTUFEQUxBZ0lHc3dJQkFRUUNEQUF3Q3dJQ0JyUUNBUUVFQWd3QU1Bc0NBZ2ExQWdFQkJBSU1BREFMQWdJR3RnSUJBUVFDREFBd0RBSUNCcVVDQVFFRUF3SUJBVEFNQWdJR3F3SUJBUVFEQWdFRE1Bd0NBZ2F1QWdFQkJBTUNBUUF3REFJQ0JyRUNBUUVFQXdJQkFEQU1BZ0lHdHdJQkFRUURBZ0VBTUF3Q0FnYTZBZ0VCQkFNQ0FRQXdFZ0lDQnE4Q0FRRUVDUUlIQnhyOVRlbTk0REFWQWdJR3BnSUJBUVFNREFvMU5qY3hOVGMxT0RBMk1Cc0NBZ2FuQWdFQkJCSU1FREl3TURBd01EQTNNRFl3T0Rrek5EVXdHd0lDQnFrQ0FRRUVFZ3dRTWpBd01EQXdNRGN3TlRVeE5ETTFNekFmQWdJR3FBSUJBUVFXRmhReU1ESTBMVEE1TFRBMVZERXlPakV3T2pFMldqQWZBZ0lHcWdJQkFRUVdGaFF5TURJMExUQTVMVEExVkRBMU9qTTRPalEzV2pBZkFnSUdyQUlCQVFRV0ZoUXlNREkwTFRBNUxUQTFWREV5T2pFek9qRTJXcUNDRHVJd2dnWEdNSUlFcnFBREFnRUNBaEFWNTUvT1VsVUtaUUY4a2QvazdyTlpNQTBHQ1NxR1NJYjNEUUVCQ3dVQU1IVXhSREJDQmdOVkJBTU1PMEZ3Y0d4bElGZHZjbXhrZDJsa1pTQkVaWFpsYkc5d1pYSWdVbVZzWVhScGIyNXpJRU5sY25ScFptbGpZWFJwYjI0Z1FYVjBhRzl5YVhSNU1Rc3dDUVlEVlFRTERBSkhOVEVUTUJFR0ExVUVDZ3dLUVhCd2JHVWdTVzVqTGpFTE1Ba0dBMVVFQmhNQ1ZWTXdIaGNOTWpJd09UQXlNVGt4TXpVM1doY05NalF4TURBeE1Ua3hNelUyV2pDQmlURTNNRFVHQTFVRUF3d3VUV0ZqSUVGd2NDQlRkRzl5WlNCaGJtUWdhVlIxYm1WeklGTjBiM0psSUZKbFkyVnBjSFFnVTJsbmJtbHVaekVzTUNvR0ExVUVDd3dqUVhCd2JHVWdWMjl5YkdSM2FXUmxJRVJsZG1Wc2IzQmxjaUJTWld4aGRHbHZibk14RXpBUkJnTlZCQW9NQ2tGd2NHeGxJRWx1WXk0eEN6QUpCZ05WQkFZVEFsVlRNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXZFVE9DNjFxTUhhdndBa01OSG9aWWUrOUlBMzEra09lRS9Xczh6eVREdGRsbTNUQ1dqY25WUENPelVZNmdzeDF2eExnQ3ludVdHdWc1MElxOTRjQW42TE1xU0xtYmVnTjU4c1A5TkJrVzdPL2pXUE53cHRpc0NuWDNzQ2pqYTBicFBqcmFOdHpoaTVmekxzaGZXdTRPRzZyN3lLRFNCUDJSS0trUnB6bFl1eDBPMzgzbEtKMmFvZ2hld1I4b2RPem51STFiYWVPajdEalpkYklNeDlPam9vRDdPbTl6QisxcDRhT0JQQ1E3N29oam0yU1luTEJpZENZL3VOVnlWYkdOSFQrOUI2YVEzQmhmWDZHd25uZFVIWGRDTERrcUxWNk5uMlgvUGxKSUIzbkVtS29aZG84RmxqK0psR1BrWG1yUFZ1NytTN1RPMUlIR0REbmZ3K1k3d0lEQVFBQm80SUNPekNDQWpjd0RBWURWUjBUQVFIL0JBSXdBREFmQmdOVkhTTUVHREFXZ0JRWmk1ZU5TbHRoZUZmMHBWdzFFb281Q09Pd2RUQndCZ2dyQmdFRkJRY0JBUVJrTUdJd0xRWUlLd1lCQlFVSE1BS0dJV2gwZEhBNkx5OWpaWEowY3k1aGNIQnNaUzVqYjIwdmQzZGtjbWMxTG1SbGNqQXhCZ2dyQmdFRkJRY3dBWVlsYUhSMGNEb3ZMMjlqYzNBdVlYQndiR1V1WTI5dEwyOWpjM0F3TXkxM2QyUnlaelV3TlRDQ0FSOEdBMVVkSUFTQ0FSWXdnZ0VTTUlJQkRnWUtLb1pJaHZkalpBVUdBVENCL3pBM0JnZ3JCZ0VGQlFjQ0FSWXJhSFIwY0hNNkx5OTNkM2N1WVhCd2JHVXVZMjl0TDJObGNuUnBabWxqWVhSbFlYVjBhRzl5YVhSNUx6Q0J3d1lJS3dZQkJRVUhBZ0l3Z2JZTWdiTlNaV3hwWVc1alpTQnZiaUIwYUdseklHTmxjblJwWm1sallYUmxJR0o1SUdGdWVTQndZWEowZVNCaGMzTjFiV1Z6SUdGalkyVndkR0Z1WTJVZ2IyWWdkR2hsSUhSb1pXNGdZWEJ3YkdsallXSnNaU0J6ZEdGdVpHRnlaQ0IwWlhKdGN5QmhibVFnWTI5dVpHbDBhVzl1Y3lCdlppQjFjMlVzSUdObGNuUnBabWxqWVhSbElIQnZiR2xqZVNCaGJtUWdZMlZ5ZEdsbWFXTmhkR2x2YmlCd2NtRmpkR2xqWlNCemRHRjBaVzFsYm5SekxqQXdCZ05WSFI4RUtUQW5NQ1dnSTZBaGhoOW9kSFJ3T2k4dlkzSnNMbUZ3Y0d4bExtTnZiUzkzZDJSeVp6VXVZM0pzTUIwR0ExVWREZ1FXQkJRaXlUeDdZeE9GdmpvN3hUT3B0UHF4c0lLVEZ6QU9CZ05WSFE4QkFmOEVCQU1DQjRBd0VBWUtLb1pJaHZkalpBWUxBUVFDQlFBd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFEeEc3cytvUExqOW5vUExVZkQycUZIODRnY2RnaVRjN3BLS0crcE5xT283VDRjeW1qazUyMXY0VzlwTmpjMzdDVW9Mc2MyYUdXOU94LzFvV3p2YytWZVBreVJLaEhTTm9DUm5kem1DT1EyUEwzeUJnUS90NjF2NGRiVDg4OTZVa2IxTWhSeDkwWTVuWkVpQ0JncXdZU1RFOEZBclZscXV6VzdBZDRCaHp3anlvRkhsYy9rQmtSTm5Ndjh6Y1RNN01FOUxNQVY4TGJNNWE5OG1YYTk4dVhZR3VhNExIMlZRVlFITm9iTlBPWEVFTWNaSWRSVW1QMHJmS3VTQ3lvNFlaZWxnc0k2RzR0WksxSE9aSksxT0ZVNXRSVWhyeGdPN2R6UkduVWZYcEdqM0QzUkFRamQ0aENpK0Fpc0tEb3plVmttYVVNMENlVHVNMERxb3I1a2N5b0V3Z2dSVk1JSURQYUFEQWdFQ0FoUTdmb0FLN3RNQ29lYnMyNWZaeXF3b25QRnBsREFOQmdrcWhraUc5dzBCQVFzRkFEQmlNUXN3Q1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ2hNS1FYQndiR1VnU1c1akxqRW1NQ1FHQTFVRUN4TWRRWEJ3YkdVZ1EyVnlkR2xtYVdOaGRHbHZiaUJCZFhSb2IzSnBkSGt4RmpBVUJnTlZCQU1URFVGd2NHeGxJRkp2YjNRZ1EwRXdIaGNOTWpBeE1qRTJNVGt6T0RVMldoY05NekF4TWpFd01EQXdNREF3V2pCMU1VUXdRZ1lEVlFRREREdEJjSEJzWlNCWGIzSnNaSGRwWkdVZ1JHVjJaV3h2Y0dWeUlGSmxiR0YwYVc5dWN5QkRaWEowYVdacFkyRjBhVzl1SUVGMWRHaHZjbWwwZVRFTE1Ba0dBMVVFQ3d3Q1J6VXhFekFSQmdOVkJBb01Da0Z3Y0d4bElFbHVZeTR4Q3pBSkJnTlZCQVlUQWxWVE1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBbjEzYUgvdjZ2TkJMSWp6SDFpYjZGL2Ywbng0K1pCRm1tdTlldnFzMHZhb3NJVzdXSHBRaGhTeDB3UTRRWWFvOFkwcCtTdVBJZGRiUHdwd0lTSHRxdVNteHlXYjl5SW9XMGJJRVBJSzZnR3ppL3dweTY2eitPMjlJdnA2TEVVMlZmYko3a0M4Q0hFNzhTYjdYYjdWUHZuakcydDZ5emNuWlpoRTdXdWtKUlhPSlVOUk80bWdGZnRwMW5Fc0JydHJqejIxMFRkNVQwTlVhT0lJNjBKM2pYU2w3c1lIcUtTY0wrMkI4aGhMNzhHSlBCdWRNMFIvWmJaN3RjOXA0SVEyZGNObEdWNUJmWjRUQmMzY0txR0ppdHE1d2hydDFJNG10ZWZibXBOVDlneVl5Q2pza2tsc2dvWnpSTDRBWW05MDhDK2UxL2V5QVZ3OFhuajhyaHllNzl3SURBUUFCbzRIdk1JSHNNQklHQTFVZEV3RUIvd1FJTUFZQkFmOENBUUF3SHdZRFZSMGpCQmd3Rm9BVUs5QnBSNVIyQ2Y3MGE0MHVRS2IzUjAxL0NGNHdSQVlJS3dZQkJRVUhBUUVFT0RBMk1EUUdDQ3NHQVFVRkJ6QUJoaWhvZEhSd09pOHZiMk56Y0M1aGNIQnNaUzVqYjIwdmIyTnpjREF6TFdGd2NHeGxjbTl2ZEdOaE1DNEdBMVVkSHdRbk1DVXdJNkFob0IrR0hXaDBkSEE2THk5amNtd3VZWEJ3YkdVdVkyOXRMM0p2YjNRdVkzSnNNQjBHQTFVZERnUVdCQlFaaTVlTlNsdGhlRmYwcFZ3MUVvbzVDT093ZFRBT0JnTlZIUThCQWY4RUJBTUNBUVl3RUFZS0tvWklodmRqWkFZQ0FRUUNCUUF3RFFZSktvWklodmNOQVFFTEJRQURnZ0VCQUZyRU5hTFo1Z3FlVXFJQWdpSjN6WEl2a1BraXJ4UWx6S29LUW1DU3dyMTFIZXRNeWhYbGZtdEFFRjc3VzBWMERmQjZmWWlSenQ1amkwS0owaGpmUWJOWW5nWUloMGpkUUs4ajFlM3JMR0RsNjZSL0hPbWNnOWFVWDB4aU9ZcE9yaE9OZlVPNDNGNnN2aGhBOHVZUExGMFRrL0Y3WmFqQ2FFamUvN1NXbXd6N01qYWVuZzJWWHpnS2k1YlNFbXkzaXd1TzF6N3Nid0dxemsxRllOdUVjV1ppNVJsbE1NMksvMFZUKzI3N2lIZER3MGhqK2ZkUnMzSmVlZUpXejd5N2hMazRXbml1RVVoU3V3MDFpNVRlekhTYWFQVkpZSlNzOHFpekZZYVEwTXd3UTRiVDVYQUNVYlNCd0tpWDFPcnFzSXdKUU84NGs3TE5JZ1ByWjBObHlFVXdnZ1M3TUlJRG82QURBZ0VDQWdFQ01BMEdDU3FHU0liM0RRRUJCUVVBTUdJeEN6QUpCZ05WQkFZVEFsVlRNUk13RVFZRFZRUUtFd3BCY0hCc1pTQkpibU11TVNZd0pBWURWUVFMRXgxQmNIQnNaU0JEWlhKMGFXWnBZMkYwYVc5dUlFRjFkR2h2Y21sMGVURVdNQlFHQTFVRUF4TU5RWEJ3YkdVZ1VtOXZkQ0JEUVRBZUZ3MHdOakEwTWpVeU1UUXdNelphRncwek5UQXlNRGt5TVRRd016WmFNR0l4Q3pBSkJnTlZCQVlUQWxWVE1STXdFUVlEVlFRS0V3cEJjSEJzWlNCSmJtTXVNU1l3SkFZRFZRUUxFeDFCY0hCc1pTQkRaWEowYVdacFkyRjBhVzl1SUVGMWRHaHZjbWwwZVRFV01CUUdBMVVFQXhNTlFYQndiR1VnVW05dmRDQkRRVENDQVNJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0NBUW9DZ2dFQkFPU1JxUWtma2RzZVIxRHJCZTFlZVlRdDZ6YWlWMHhWN0lzWmlkNzVTMnoxQjZzaU1BTG9HRDc0VUFuVGYwR29tUG5SeW1hY0pHc1IwS083NUJzcXd4K1Zubm9NcEVlTFc5UVdOelBMeEE5TnpoUnAwY2taY3ZWZER0Vi9YNXZ5SlFPNlZZOU5YUTN4WkRVakZVc1ZXUjJ6bFBmMm5KN1BVTHJCV0ZCbmp3aTBJUGZMckN3Z2IzQzJQd0V3akxkRHp3K2RQZk1yU1NnYXlQN090YmtPMlY0YzFzczl0VHF0OUE4T0FKSUxzU0VXTG5UVlBBM2JZaGFybzNHU1IxTlZ3YTh2UWJQNCsrTnd6ZWFqVEVWK0gweHJVSlpCaWNSMFlnc1FnMEdITTRxQnNUQlk3Rm9FTW94b3M0OGQzbVZ6LzJkZVpieEoySGFmTXhSbG9YZVV5UzBDQXdFQUFhT0NBWG93Z2dGMk1BNEdBMVVkRHdFQi93UUVBd0lCQmpBUEJnTlZIUk1CQWY4RUJUQURBUUgvTUIwR0ExVWREZ1FXQkJRcjBHbEhsSFlKL3ZScmpTNUFwdmRIVFg4SVhqQWZCZ05WSFNNRUdEQVdnQlFyMEdsSGxIWUovdlJyalM1QXB2ZEhUWDhJWGpDQ0FSRUdBMVVkSUFTQ0FRZ3dnZ0VFTUlJQkFBWUpLb1pJaHZkalpBVUJNSUh5TUNvR0NDc0dBUVVGQndJQkZoNW9kSFJ3Y3pvdkwzZDNkeTVoY0hCc1pTNWpiMjB2WVhCd2JHVmpZUzh3Z2NNR0NDc0dBUVVGQndJQ01JRzJHb0d6VW1Wc2FXRnVZMlVnYjI0Z2RHaHBjeUJqWlhKMGFXWnBZMkYwWlNCaWVTQmhibmtnY0dGeWRIa2dZWE56ZFcxbGN5QmhZMk5sY0hSaGJtTmxJRzltSUhSb1pTQjBhR1Z1SUdGd2NHeHBZMkZpYkdVZ2MzUmhibVJoY21RZ2RHVnliWE1nWVc1a0lHTnZibVJwZEdsdmJuTWdiMllnZFhObExDQmpaWEowYVdacFkyRjBaU0J3YjJ4cFkza2dZVzVrSUdObGNuUnBabWxqWVhScGIyNGdjSEpoWTNScFkyVWdjM1JoZEdWdFpXNTBjeTR3RFFZSktvWklodmNOQVFFRkJRQURnZ0VCQUZ3Mm1Vd3RlTGZ0akp2YzgzZWI4bmJTZHpCUHdSK0ZnNFVibVQxSE4vS3BtMENPTE5TeGtCTFl2dlJ6bSs3U1pBL0xlVTgwMktJKytYai9hOGdIN0gwNWc0dFRJTk00eExHL21rOEthLzhyL0ZtbkJRbDhGMEJXRVI1MDA3ZUxJenRIbzlWdkpPTHIwYmR3M3c5RjRTZks4VzE0N2VlMUZ4ZW8zSDRpTmNvbDFka1AxbXZVb2lRakVmZWhySTl6Z1dER0cxc0pMNUt5K0VSSThHQTRuaFgxUFNabklJb3phdmNOZ3MvZTY2TXYrVk5xVzJUQVl6TjM5em9ITEZicjJnOGhEdHE2Y3hsUHRkazJmOEdIVmRtbm1ia3lRdnZZMVhHZWZxRlN0eHU5azBJa0VpckhEeDIyVFp4ZVk4aExnQmRRcW9yVjJ1VDgwQWtITjdCMWRTRXhnZ0cxTUlJQnNRSUJBVENCaVRCMU1VUXdRZ1lEVlFRREREdEJjSEJzWlNCWGIzSnNaSGRwWkdVZ1JHVjJaV3h2Y0dWeUlGSmxiR0YwYVc5dWN5QkRaWEowYVdacFkyRjBhVzl1SUVGMWRHaHZjbWwwZVRFTE1Ba0dBMVVFQ3d3Q1J6VXhFekFSQmdOVkJBb01Da0Z3Y0d4bElFbHVZeTR4Q3pBSkJnTlZCQVlUQWxWVEFoQVY1NS9PVWxVS1pRRjhrZC9rN3JOWk1BMEdDV0NHU0FGbEF3UUNBUVVBTUEwR0NTcUdTSWIzRFFFQkFRVUFCSUlCQUtCNjc2WWZMTWRrM3hHQ1E4WjhaaktQdWpobWM3S1BFQnpXeFZ0RVFXL3g5MFo3eFFWdDhaWmQ4dnhZVmlhR0VhVW5ZM1FsdmNtY3RJTnZUYTAwMjMrSTRGL3RHa0JCSUYyblZZSHh3eDJQT0FxRjlKMm4zTTdNZzY1Q0J6UUJwNlhVNnYwb29KMDJ4NmRLMStpb3UvZjQwWnUwYytoSGtXOFgwTy96MTBlSlFQd2kvY3REMmdqOERMSkFzWlEzTFArejNIZ2ZIQlhJODh4TWl4L3VXNkJJLzkybDBJOVBJek15YldpKzN3T3BsT0tNNlNRZ1NPNmlmY2NjSVRCdENCT0hBdW0yM29XVGlmdHlCYTRXYnEwanhNaWpTMFZkZ3NGZ1czSTl3RE5iMHhzL1VFZTg2eUphUWp0U1dXMDVyb2xyYXB2cEc5dXErcWRjVm1MdkI2UT0';

        // Step 2: Send the receipt to Apple's servers for validation
        $response = $this->sendReceiptToApple($receiptData);

        // Step 3: Handle the response and check if the subscription is valid
        return $this->handleAppleResponse($response);
    }

    private function callAppleApi($url, $postData)
    {
        // Send the POST request with raw JSON data
        $response = Http::withHeaders([
            'Content-Type' => 'application/json',
        ])->post($url, $postData);

        // Return the JSON response
        return $response->json();
    }


    private function sendReceiptToApple($receiptData)
    {
        $postData = json_encode([
            'receipt-data' => $receiptData,
            'password' => '7f3ca98c91d643fe93fc5f796f8d73bc', // Fetch shared secret from config
        ]);

        // First, try verifying with the production URL
        $response = $this->callAppleApi($this->appleProductionUrl, $postData);

        // If status 21007 is returned, try the sandbox URL
        if (isset($response['status']) && $response['status'] == 21007) {
            $response = $this->callAppleApi($this->appleSandboxUrl, $postData);
        }

        return $response;
    }


    private function handleAppleResponse($response)
    {
        if (isset($response['status']) && $response['status'] == 0) {
            // The receipt is valid
            return response()->json([
                'success' => true,
                'message' => 'Subscription is valid.',
                'data' => $response,  // Optionally include receipt data here
            ], 200);
        } else {
            // Log the response details for debugging
            Log::error('Apple subscription validation failed', [
                'response' => $response,
                'error_code' => $response['status'] ?? 'Unknown',
            ]);

            // Return error response
            return response()->json([
                'success' => false,
                'message' => 'Subscription validation failed.',
                'error_code' => $response['status'] ?? 'Unknown',
            ], 400);
        }
    }





}
